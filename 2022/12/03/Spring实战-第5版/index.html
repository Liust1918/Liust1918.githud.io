<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Spring实战(第5版) - Liust of Blog</title><link rel="manifest" href="/Liust1918.githud.io/manifest.json"><meta name="application-name" content="Liust of Blog"><meta name="msapplication-TileImage" content="/img/Battlerfiled3.jpg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Liust of Blog"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="Spring实战(第5版)书(弃用)"><meta property="og:type" content="blog"><meta property="og:title" content="Spring实战(第5版)"><meta property="og:url" content="https://liust1918.github.io/Liust1918.githud.io/2022/12/03/Spring%E5%AE%9E%E6%88%98-%E7%AC%AC5%E7%89%88/"><meta property="og:site_name" content="Liust of Blog"><meta property="og:description" content="Spring实战(第5版)书(弃用)"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="d:/TyporaOfimage/615156-20160131220456193-145289785.png"><meta property="og:image" content="d:/TyporaOfimage/密码转换器.png"><meta property="article:published_time" content="2022-12-03T15:54:28.000Z"><meta property="article:modified_time" content="2022-12-03T16:37:29.468Z"><meta property="article:author" content="Liust"><meta property="article:tag" content="java"><meta property="article:tag" content="后端"><meta property="article:tag" content="技术书"><meta property="article:tag" content="spring"><meta property="article:tag" content="Hibernate"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="d:/TyporaOfimage/615156-20160131220456193-145289785.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://liust1918.github.io/Liust1918.githud.io/2022/12/03/Spring%E5%AE%9E%E6%88%98-%E7%AC%AC5%E7%89%88/"},"headline":"Spring实战(第5版)","image":["d:/TyporaOfimage/615156-20160131220456193-145289785.png","d:/TyporaOfimage/密码转换器.png"],"datePublished":"2022-12-03T15:54:28.000Z","dateModified":"2022-12-03T16:37:29.468Z","author":{"@type":"Person","name":"Liust"},"publisher":{"@type":"Organization","name":"Liust of Blog","logo":{"@type":"ImageObject","url":"https://liust1918.github.io/img/Battlerfiled3.jpg"}},"description":"Spring实战(第5版)书(弃用)"}</script><link rel="canonical" href="https://liust1918.github.io/Liust1918.githud.io/2022/12/03/Spring%E5%AE%9E%E6%88%98-%E7%AC%AC5%E7%89%88/"><link rel="icon" href="/Liust1918.githud.io/img/Battlerfiled3.jpg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/Liust1918.githud.io/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><script data-ad-client="liust" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js" async></script><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }
          Array
              .from(document.querySelectorAll('.tab-content'))
              .forEach($tab => {
                  $tab.classList.add('is-hidden');
              });
          Array
              .from(document.querySelectorAll('.tabs li'))
              .forEach($tab => {
                  $tab.classList.remove('is-active');
              });
          const $activeTab = document.querySelector(location.hash);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
          const $tabMenu = document.querySelector(`a[href="${location.hash}"]`);
          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/Liust1918.githud.io/"><img src="/Liust1918.githud.io/img/Battlerfiled3.jpg" alt="Liust of Blog" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/Liust1918.githud.io/">主页(Home)</a><a class="navbar-item" href="/Liust1918.githud.io/archives">文章(Archives)</a><a class="navbar-item" href="/Liust1918.githud.io/categories">类型(Categories)</a><a class="navbar-item" href="/Liust1918.githud.io/tags">标签(Tags)</a><a class="navbar-item" href="/Liust1918.githud.io/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="My GitHub" href="https://github.com/Liust1918"><i class="fab fa-github"></i></a><a class="navbar-item is-hidden-tablet catalogue" title="目录" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2022-12-03T15:54:28.000Z" title="2022/12/3 23:54:28">2022-12-03</time>发表</span><span class="level-item"><time dateTime="2022-12-03T16:37:29.468Z" title="2022/12/4 00:37:29">2022-12-04</time>更新</span><span class="level-item"><a class="link-muted" href="/Liust1918.githud.io/categories/%E5%90%8E%E7%AB%AF/">后端</a><span> / </span><a class="link-muted" href="/Liust1918.githud.io/categories/%E5%90%8E%E7%AB%AF/spring/">spring</a></span><span class="level-item">1 小时读完 (大约13232个字)</span></div></div><h1 class="title is-3 is-size-4-mobile">Spring实战(第5版)</h1><div class="content"><h2 id="Spring实战-第5版-书-弃用"><a href="#Spring实战-第5版-书-弃用" class="headerlink" title="Spring实战(第5版)书(弃用)"></a>Spring实战(第5版)书(弃用)</h2><span id="more"></span>
<h2 id="Spring基础"><a href="#Spring基础" class="headerlink" title="Spring基础"></a>Spring基础</h2><h3 id="Spring起步"><a href="#Spring起步" class="headerlink" title="Spring起步"></a>Spring起步</h3><p>Spring框架可以‘支持的:</p>
<ol>
<li><strong>传统应用</strong>:基于浏览器的Web应用,后端由关系型数据库作为支撑</li>
<li><strong>SpringBoot</strong>:简化开发模型</li>
<li><strong>微服务</strong>：开发面向云的由微服务组成的应用</li>
<li><strong>反应式编程</strong>:致力于通过非阻塞操作提供更好的拓展性并提升性能.</li>
</ol>
<h4 id="什么是Spring"><a href="#什么是Spring" class="headerlink" title="什么是Spring"></a>什么是Spring</h4><h5 id="Spring核心"><a href="#Spring核心" class="headerlink" title="Spring核心"></a>Spring核心</h5><p><strong>容器(container)&#x2F;Spring应用上下文(Spring application context)</strong>:创建和管理应用组件</p>
<p><strong>组件(bean)</strong>:在Spring上下文中相互装配</p>
<h5 id="组件的装配方式"><a href="#组件的装配方式" class="headerlink" title="组件的装配方式:"></a><strong>组件的装配方式</strong>:</h5><p><strong>依赖注入(denpendency injection,DI)</strong>:将组件注入到需要它们的bean中.</p>
<p>实现方式:</p>
<ol>
<li>构造方法</li>
<li>setter方法</li>
</ol>
<h5 id="指导Spring应用上下文将bean装配的方式-显式配置"><a href="#指导Spring应用上下文将bean装配的方式-显式配置" class="headerlink" title="指导Spring应用上下文将bean装配的方式(显式配置):"></a><strong>指导Spring应用上下文将bean装配的方式</strong>(显式配置):</h5><ol>
<li><p>XML文件(过时)</p>
</li>
<li><p><strong>基于java的配置文件</strong></p>
<hr>
<ul>
<li>@Configuration:设置配置类(容器)</li>
<li>@Bean:设置该方法为组件</li>
<li>方法名:相当于id</li>
<li>返回类型:相当于class</li>
</ul>
<p>优点:</p>
<p>比XML配置更好的重构能力和更强的类型安全性</p>
</li>
</ol>
<p>Tips:只有当Spring不能用自动配置的时候采用显式配置</p>
<h5 id="自动配置"><a href="#自动配置" class="headerlink" title="自动配置"></a>自动配置</h5><p>自动扫描类路径来装配bean</p>
<p>Spring:<strong>自动装配(autowiring)和组件扫描(component scanning)</strong></p>
<p>Spring Boot:<strong>自动配置(autoconfiguration)</strong></p>
<p>Spring Boot是Spring框架的拓展,提高生成效率的方法,大幅减少显式配置的数量.</p>
<h4 id="Spring项目结构"><a href="#Spring项目结构" class="headerlink" title="Spring项目结构"></a>Spring项目结构</h4><ul>
<li><strong>mvnw和mvnw.cmd</strong>:Maven包装类(wrapper)脚本,没有Maven也可构建项目.</li>
<li><strong>pom.xml</strong>:Maven构建规范</li>
<li><strong>XXXXApplication.java</strong>:Spring Boot主类,用来启动项目.</li>
<li><strong>application.properties</strong>:指定配置文件</li>
<li><strong>static</strong>：存放静态内容(图片,样式表,JavaScript等)</li>
<li><strong>templates</strong>:放渲染内容到浏览器的模板文件</li>
<li><strong>XXXXApplicationTests.java</strong>:简单测试类,确保Spring’应用上下文可以成功加载.</li>
</ul>
<h5 id="探索构建规范"><a href="#探索构建规范" class="headerlink" title="探索构建规范"></a>探索构建规范</h5><p>控制打包(jar包&#x2F;war包)</p>
<ul>
<li>JAR包是基于云思维</li>
<li>WAR包是想部署到传统java应用服务器上.</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">packaging</span>&gt;</span>jar或者war<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h6 id="父POM-Spring-Boot-starts-parent"><a href="#父POM-Spring-Boot-starts-parent" class="headerlink" title="父POM(Spring-Boot-starts-parent)"></a>父POM(Spring-Boot-starts-parent)</h6><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--    Spring Boot的版本--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.5.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>spirng-boot-starts-parent有一个父POM,</p>
<p>作用:</p>
<ul>
<li><strong>提供依赖管理,不用指定里面的依赖版本</strong></li>
<li><strong>父POM提供版本</strong>(version)</li>
<li><strong>dependencies从父POM拉取库,不包含库代码</strong>:在dependencies中spring boot starter依赖本身不包含库代码,只是从父POM拉取.</li>
</ul>
<p>好处：</p>
<ol>
<li>构建文件会显著减少并更易于管理,不必为每个所需的依赖库都声明依赖.</li>
<li>可以根据它们所提供的功能来思考依赖，而不是根据库的名称</li>
<li>不用担心库版本的问题</li>
</ol>
<h6 id="Spring-Boot插件"><a href="#Spring-Boot插件" class="headerlink" title="Spring Boot插件"></a>Spring Boot插件</h6><ul>
<li>提供Maven goal,允许使用Maven来允许应用</li>
<li>确保依赖的所有库都会包含在可执行JAR文件中,并保证它们在运行时类路径下是可用的.</li>
<li>在JAR中生成一个manifest文件,将引导类声明为JAR的主类</li>
</ul>
<h5 id="引用应用"><a href="#引用应用" class="headerlink" title="引用应用"></a>引用应用</h5><p>JAR包有个主类,主类中有mian()方法.是运行jar包执行类中的方法.(XXXXApplication.java)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TacoCloudApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(TacoCloudApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="SpringBootApplication组合注解"><a href="#SpringBootApplication组合注解" class="headerlink" title="@SpringBootApplication组合注解"></a>@SpringBootApplication组合注解</h6><ol>
<li><strong>@SpringBootConfiguration</strong>:将给类声明为配置类.</li>
<li><strong>@EnableAutoConfiguration</strong>:启用Spring Boot的自动配置</li>
<li><strong>@ComponentScan</strong>:组件扫描</li>
</ol>
<p>过程:</p>
<p>JAR包找到主类，再找到mian方法，在mian方法中调用SpringApplication中的静态run()方法，一个是配置类，另一个是命令行参数.然后创建Spring的应用上下文.(所有这个类一般不用管也不用改)</p>
<h5 id="测试应用"><a href="#测试应用" class="headerlink" title="测试应用"></a>测试应用</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TacoCloudApplicationTests</span> &#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">contextLoads</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>即使这个方法为空,也<strong>会检查Spirng应用上下文能够成功加载.</strong></p>
<h6 id="RunWith-SpringRunner-class"><a href="#RunWith-SpringRunner-class" class="headerlink" title="@RunWith(SpringRunner.class)"></a>@RunWith(SpringRunner.class)</h6><ul>
<li><strong>Spring运行器</strong>:提供一个测试运行器(runner)来指导JUnit如何运行测试</li>
<li><strong>SpringRunner</strong>:SpringJUnit4ClassRunner的别名</li>
</ul>
<h6 id="SpringBootTest"><a href="#SpringBootTest" class="headerlink" title="@SpringBootTest"></a>@SpringBootTest</h6><ul>
<li>告诉JUnit在启动测试的时候要添加上Spring Boot的功能.</li>
</ul>
<h4 id="SpringBoot项目启动方式"><a href="#SpringBoot项目启动方式" class="headerlink" title="SpringBoot项目启动方式"></a>SpringBoot项目启动方式</h4><ol>
<li>直接通过主类启动</li>
<li>命令行:mvn spring-boot:run(需要spring-boot-maven-plugin插件)</li>
<li>打包jar包&#x2F;war包,然后java -jar 包名.jar&#x2F;war</li>
<li>通过servlet容器开启(类似tomcat)</li>
</ol>
<h4 id="Spring-Boot-DevTools"><a href="#Spring-Boot-DevTools" class="headerlink" title="Spring Boot DevTools"></a>Spring Boot DevTools</h4><p>便利的开发工具</p>
<ul>
<li>代码变更后应用会自动重启</li>
<li>当面向浏览器的资源(如模板,JavaScript,样式表)等发生变化时，会自动刷新浏览器</li>
<li>自动禁用模板缓存</li>
<li>如果使用H2数据库的话,内置了H2控制台.</li>
</ul>
<h5 id="应用自动重启"><a href="#应用自动重启" class="headerlink" title="应用自动重启"></a>应用自动重启</h5><p>DevTools运行时,应用程序加载到java虚拟机(JVM)两个独立的类加载器:</p>
<ul>
<li>加载你的java代码,属性文件以及项目中”src&#x2F;main&#x2F;“路径下所有内容</li>
<li>加载依赖的库</li>
</ul>
<p>过程:</p>
<p>当监测到变化就重新加载包含项目代码的类加载器并重启容器,另一个类加载器和JVM不会动.</p>
<p>不足：</p>
<p>当依赖发生变化的时候,需要重启应用.</p>
<h5 id="浏览器自动刷新和禁用模板缓存"><a href="#浏览器自动刷新和禁用模板缓存" class="headerlink" title="浏览器自动刷新和禁用模板缓存"></a>浏览器自动刷新和禁用模板缓存</h5><p>废话阶段:</p>
<p>在具体生成环境,模板会在解析后缓存在浏览器,这样每次请求都不用再解析.</p>
<p>但是再开发环境中，修改模板后,模板不会更新.DevTools禁用所用模板缓存.</p>
<p><strong>具体操作</strong>:</p>
<ul>
<li>只需要刷新浏览器就可用刷新模板.</li>
<li>静态内容修改自动刷新</li>
</ul>
<h5 id="内置的H2控制台"><a href="#内置的H2控制台" class="headerlink" title="内置的H2控制台"></a>内置的H2控制台</h5><p>如果有H2数据库,就直接去<a target="_blank" rel="noopener" href="http://localhost:8080/h2-console%E6%89%93%E5%BC%80%E6%8E%A7%E5%88%B6%E5%8F%B0">http://localhost:8080/h2-console打开控制台</a>.</p>
<hr>
<h3 id="开发Web应用"><a href="#开发Web应用" class="headerlink" title="开发Web应用"></a>开发Web应用</h3><p>Spring MVC的模型数据和处理表单输入</p>
<h4 id="设计后端"><a href="#设计后端" class="headerlink" title="设计后端"></a>设计后端</h4><ul>
<li><strong>Pojo类</strong></li>
<li><strong>Spring MVC控制器类</strong>:获取和处理数据</li>
<li><strong>视图模板</strong>:将数据渲染到HTML中并在浏览器展示.</li>
</ul>
<h5 id="构建Pojo类"><a href="#构建Pojo类" class="headerlink" title="构建Pojo类"></a>构建Pojo类</h5><p>现实中实际问题抽象化.</p>
<p>使用Lombok中的@Data,重写getter,setter,equals,hashCode,toString方法.</p>
<ul>
<li><p>但是如果想使用构造方法,就添加final.(但是setter不会写)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span>  String info;</span><br></pre></td></tr></table></figure>
</li>
<li><p>没有final,就只有setter注入.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Bean</span> &#123;</span><br><span class="line">    <span class="keyword">private</span>  String info;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h5 id="创建控制器类"><a href="#创建控制器类" class="headerlink" title="创建控制器类"></a>创建控制器类</h5><h6 id="主要职责"><a href="#主要职责" class="headerlink" title="主要职责"></a>主要职责</h6><p>处理HTTP请求</p>
<ul>
<li>将请求传递给视图</li>
<li>直接将数据写入响应体(RESTful)</li>
</ul>
<h6 id="控制器类基本构成"><a href="#控制器类基本构成" class="headerlink" title="控制器类基本构成"></a>控制器类基本构成</h6><ol>
<li><p><strong>@Slf4j</strong></p>
<hr>
<p>属于Lombok注解,SLF4J(Simple Logging Facade for Java) Logger</p>
<p>本质上:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> org.slf4j.Logger log=org.slf4j.LoggerFactory.getLogger(本类.class);</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>@Controller</strong></p>
</li>
<li><p><strong>@RequestMapping(“&#x2F;路径1&#x2F;路径2”)</strong></p>
<ul>
<li><strong>类级别</strong>:指定基本路径<ul>
<li><strong>@RequestMapping</strong></li>
</ul>
</li>
<li><strong>方法级别</strong>:更具体注解<ul>
<li><strong>@GetMapping</strong></li>
<li><strong>@PostMapping</strong></li>
<li><strong>@DeleteMapping</strong></li>
<li><strong>@PatchMapping</strong></li>
</ul>
</li>
</ul>
</li>
<li><p><strong>Model数据模型</strong></p>
<ul>
<li><p>职责:<strong>控制器和展示数据的视图之间传递数据.</strong></p>
</li>
<li><p>Model属性中的数据将会复制到Servlet Response的属性，视图能从这里找到所需的数据.</p>
</li>
<li><p>&#96;&#96;&#96;java<br>public String to(Model model){<br>model.addAttribute(“key名字”, 数据对象);<br>return “TemplateOne”;<br>}</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">5. **返回视图逻辑名称**</span><br><span class="line"></span><br><span class="line">   - 映射到templates文件中(相当于视图解析器).</span><br><span class="line">   - **转发**</span><br><span class="line">     - &quot;地址&quot;(默认)</span><br><span class="line">     - &quot;forward:地址&quot;</span><br><span class="line">   - **重定向**</span><br><span class="line">     - &quot;**redirect**:地址&quot;</span><br><span class="line"></span><br><span class="line">   </span><br><span class="line"></span><br><span class="line">##### 设计视图</span><br><span class="line"></span><br><span class="line">###### 视图模板</span><br><span class="line"></span><br><span class="line">- Jsp(JavaServer Pages)</span><br><span class="line">- Thymeleaf(选择这个)</span><br><span class="line">- FreeMarker</span><br><span class="line">- Mustache</span><br><span class="line">- Groovy</span><br><span class="line"></span><br><span class="line">###### 添加依赖</span><br><span class="line"></span><br><span class="line">```xml</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-thymeleaf&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ol>
<h6 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h6><p>Thymeleaf与特定的Web框架解耦.</p>
<p>Thymeleaf视图无法与控制器放到Model中的数据协同工作,但是可以与Servlet的request属性协作.</p>
<p>在Spring将请求移动到视图之前,会把模型数据复制到request属性中,这样视图模板就可以访问Model中的数据.</p>
<h4 id="处理表单提交"><a href="#处理表单提交" class="headerlink" title="处理表单提交"></a>处理表单提交</h4><ol>
<li><p><strong>method&#x3D;”post”</strong></p>
<p>表单标签form中的method改为post</p>
</li>
<li><p><strong>控制类设置@PostMapping的方法</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping</span></span><br><span class="line">   <span class="keyword">public</span> String <span class="title function_">processDesign</span><span class="params">(Bean bean)</span> &#123;</span><br><span class="line">       <span class="keyword">return</span> <span class="string">&quot;redirect:/orders/current&quot;</span>;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>视图中文本输入元素</strong></p>
<p>在表单元素form中，一些input标签中的name&#x3D;”bean对象中的成员变量“</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">th:field</span>=<span class="string">&quot;*&#123;info&#125;&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--Bean对象中的info属性--&gt;</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="校验表单输入-JSR-303"><a href="#校验表单输入-JSR-303" class="headerlink" title="校验表单输入(JSR-303)"></a>校验表单输入(JSR-303)</h4><h5 id="目的"><a href="#目的" class="headerlink" title="目的"></a>目的</h5><p>不用写一大堆if-else(显式编写声明逻辑)</p>
<p><strong>JSR-303</strong>（Bean Validation API&#x3D;&#x3D;Java的Bean校验API)</p>
<h5 id="引入依赖"><a href="#引入依赖" class="headerlink" title="引入依赖"></a>引入依赖</h5><ul>
<li><p><strong>Validation API</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-validation<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Validation API的Hibernate</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.hibernate.validator<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hibernate-validator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">version</span>&gt;</span>6.0.20.Final<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">       </span><br></pre></td></tr></table></figure></li>
</ul>
<h5 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h5><ol>
<li>对pojo类声明校验规则</li>
<li>在控制器类中声明要进行校验</li>
<li>修改表单视图来展示错误</li>
</ol>
<h5 id="声明校验规则"><a href="#声明校验规则" class="headerlink" title="声明校验规则"></a>声明校验规则</h5><table>
<thead>
<tr>
<th>约束注解</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>@Null</td>
<td>是否为空</td>
</tr>
<tr>
<td>@NotNull</td>
<td>是否为非空</td>
</tr>
<tr>
<td>@AssertTrue</td>
<td>boolean类型是否为true</td>
</tr>
<tr>
<td>@AssertFalse</td>
<td>boolean类型是否为false</td>
</tr>
<tr>
<td>@Min</td>
<td>Number和String最小值</td>
</tr>
<tr>
<td>@Max</td>
<td>Number和String最大值</td>
</tr>
<tr>
<td>@DecimalMin</td>
<td>Number和String最小值,允许存在小数</td>
</tr>
<tr>
<td>@DecimalMax</td>
<td>Number和String最大值,允许存在小数</td>
</tr>
<tr>
<td>@Size</td>
<td>String和Array,Collection,Map长度指定范围</td>
</tr>
<tr>
<td>@Digits</td>
<td>Number和String的特殊指定构成</td>
</tr>
<tr>
<td>@Past</td>
<td>Data和Calendar在指定时间之前</td>
</tr>
<tr>
<td>@Future</td>
<td>Data和Calendar在指定时间之后</td>
</tr>
<tr>
<td>@Pattern</td>
<td>String是否符合正则表达式的规则</td>
</tr>
<tr>
<td>@NotBlank</td>
<td>是否为空白</td>
</tr>
<tr>
<td>@CreditCardNumber</td>
<td>符合信用卡号</td>
</tr>
</tbody></table>
<h6 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h6><p><strong>message</strong>:出错后要展示的消息</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Taco</span> &#123;</span><br><span class="line">    <span class="meta">@NotNull</span></span><br><span class="line">    <span class="meta">@Size(min=5,message = &quot;Name must be at least 5 characters long&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="meta">@Size(min=1,message = &quot;You must choose at least 1 ingredient&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; ingredients;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="在表单绑定的时候执行校验"><a href="#在表单绑定的时候执行校验" class="headerlink" title="在表单绑定的时候执行校验"></a>在表单绑定的时候执行校验</h5><p>让表单在POST提交至对应的控制器方法时执行对应的校验.</p>
<table>
<thead>
<tr>
<th>方法参数</th>
<th>内容</th>
</tr>
</thead>
<tbody><tr>
<td>@Valid</td>
<td>添加到提交对象</td>
</tr>
<tr>
<td>Errors errors</td>
<td>新增方法参数</td>
</tr>
</tbody></table>
<h6 id="步骤-1"><a href="#步骤-1" class="headerlink" title="步骤"></a>步骤</h6><ol>
<li><p>在控制器类中post方法接收参数添加**@Valid**</p>
</li>
<li><p>在参数多一个<strong>Errors errors</strong></p>
</li>
<li><p>&#96;&#96;&#96;java<br>@PostMapping<br>  public String processOrder(@Valid Order order, Errors errors) {<br>  if (errors.hasErrors()) {<br>      return “orderForm”;<br>  }<br>  return “redirect:&#x2F;“ ;<br>  }</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">###### @Valid注解校验过程</span><br><span class="line"></span><br><span class="line">1. **绑定表单数据之后**</span><br><span class="line">2. SpringMVC对提交的**对象进行校验**</span><br><span class="line">3. 如果存在错误,**错误细节会被Errors对象==&gt;传递给Post方法**</span><br><span class="line">4. 无错误则调用Post方法</span><br><span class="line">5. 调用**hasErrors()**方法</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">##### 展现校验错误</span><br><span class="line"></span><br><span class="line">在Thymeleaf中通过**访问Errors对象**来展示错误(借助**th:errors**属性和**fields**)</span><br><span class="line"></span><br><span class="line">###### 案例</span><br><span class="line"></span><br><span class="line">```html</span><br><span class="line">&lt;span  th:if=&quot;$&#123;#fields.hasErrors(&#x27;对象中属性名&#x27;)&#125;&quot; th:errors=&quot;*&#123;对象中属性名&#125;&quot;&gt;Name Error&lt;/span&gt;</span><br></pre></td></tr></table></figure></li>
</ol>
<p>(也可以看thymeleaf相关校验内容)</p>
<h4 id="使用视图控制器"><a href="#使用视图控制器" class="headerlink" title="使用视图控制器"></a>使用视图控制器</h4><h5 id="是什么"><a href="#是什么" class="headerlink" title="是什么"></a>是什么</h5><p>只将<strong>请求转发到视图</strong>而不做其他事情的控制器.</p>
<p>(没有模型数据和逻辑处理的HTTP GET请求)</p>
<h5 id="步骤-2"><a href="#步骤-2" class="headerlink" title="步骤"></a>步骤</h5><ol>
<li><p><strong>@Configuration</strong>注册配置类（也可以在主类里面声明）</p>
</li>
<li><p>类实现<strong>WebMvcConfigurer</strong>接口</p>
</li>
<li><p>重写**addViewControllers()**方法,注册一个&#x2F;多个视图控制器</p>
</li>
<li><p>调用registry的<strong>addViewController(“输入路径”)方法</strong></p>
</li>
<li><p>执行GET请求</p>
</li>
<li><p>再调用**setViewName(“映射路径”)**方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addViewControllers</span><span class="params">(ViewControllerRegistry registry)</span> &#123;</span><br><span class="line">        registry.addViewController(<span class="string">&quot;/&quot;</span>).setViewName(<span class="string">&quot;home&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h5 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h5><p>当访问”&#x2F;“的时候会转发到”home”视图.</p>
<h5 id="WebMvcConfigurer接口"><a href="#WebMvcConfigurer接口" class="headerlink" title="WebMvcConfigurer接口"></a><strong>WebMvcConfigurer</strong>接口</h5><p>有很多方法配置SpringMVC</p>
<h5 id="设置配置类推荐"><a href="#设置配置类推荐" class="headerlink" title="设置配置类推荐"></a>设置配置类推荐</h5><p>为每种配置(Web,数据,安全等)创建新的配置类,保持应用的引导配置类尽可能整洁和简单.</p>
<h4 id="选择视图模板库"><a href="#选择视图模板库" class="headerlink" title="选择视图模板库"></a>选择视图模板库</h4><h5 id="选择"><a href="#选择" class="headerlink" title="选择"></a>选择</h5><ul>
<li>构建WAR包并运行在Servlet容器：选择JSP方案</li>
<li>构建JAR包：选择其他方案</li>
</ul>
<h5 id="缓存模板"><a href="#缓存模板" class="headerlink" title="缓存模板"></a>缓存模板</h5><ul>
<li><p>**生产环境(默认)**：模板第一次使用解析,解析结果(缓存模板)后面一直使用,对性能好.</p>
</li>
<li><p><strong>开发环境</strong>：关闭缓存模板</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#在application.properties中</span></span><br><span class="line"><span class="attr">spring.thymeleaf.cache</span>=<span class="string">false</span></span><br></pre></td></tr></table></figure>

<p>Tips：部署到生产环境要记得删.</p>
</li>
</ul>
<h3 id="数据持久化"><a href="#数据持久化" class="headerlink" title="数据持久化"></a>数据持久化</h3><p>原始的JDBC代码非常多，使用spring相关对象先消除样板代码,然后用JPA进一步消除一部分代码.</p>
<h4 id="Spring消除JDBC样板代码"><a href="#Spring消除JDBC样板代码" class="headerlink" title="Spring消除JDBC样板代码"></a>Spring消除JDBC样板代码</h4><h5 id="引入相关依赖"><a href="#引入相关依赖" class="headerlink" title="引入相关依赖"></a>引入相关依赖</h5><h6 id="Jdbc"><a href="#Jdbc" class="headerlink" title="Jdbc"></a>Jdbc</h6><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h6 id="H2数据库"><a href="#H2数据库" class="headerlink" title="H2数据库"></a>H2数据库</h6><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.h2database<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>h2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h5 id="为什么要使用JdbcTemplate"><a href="#为什么要使用JdbcTemplate" class="headerlink" title="为什么要使用JdbcTemplate"></a>为什么要使用JdbcTemplate</h5><p><strong>原生JDBC</strong>：</p>
<ol>
<li>非常复杂的样板代码</li>
<li>SQLException是一个检查型异常,无法解决创建连接，创建语句或查询语句的错误.</li>
</ol>
<p><strong>Spring的JdbcTemplate:</strong></p>
<ol>
<li><p>没有创建任何的连接和语句</p>
</li>
<li><p>不需要处理catch代码</p>
</li>
<li><p>只关心<strong>执行查询</strong>和<strong>结果映射</strong></p>
</li>
</ol>
<h5 id="使用JdbcTemplate"><a href="#使用JdbcTemplate" class="headerlink" title="使用JdbcTemplate"></a>使用JdbcTemplate</h5><ol>
<li><p>定义接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IngredientRepository</span>  &#123;</span><br><span class="line">    <span class="comment">//1.定义接口方法</span></span><br><span class="line">    Iterable&lt;Ingredient&gt; <span class="title function_">findAll</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建Dao实现类继承接口</p>
<ul>
<li><p>添加类的@Repository</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JdbcIngredientRepository</span>&#123;...&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>继承接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JdbcIngredientRepository</span> <span class="keyword">implements</span> <span class="title class_">IngredientRepository</span> &#123;...&#125;	</span><br></pre></td></tr></table></figure>
</li>
<li><p>注入JdbcTemplate</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> JdbcTemplate jdbc;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">JdbcIngredientRepository</span><span class="params">(JdbcTemplate jdbc)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.jdbc = jdbc;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>重写方法使用JdbcTemplate</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Iterable&lt;Ingredient&gt; <span class="title function_">findAll</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> jdbc.query(<span class="string">&quot;select id,name,type from Ingredient&quot;</span>, <span class="built_in">this</span>::mapRowToIngredient);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>Controller类接收Dao类并使用</p>
<ul>
<li>用构造方法引入实现类后使用.</li>
</ul>
</li>
</ol>
<h5 id="JdbcTemplate查询数据"><a href="#JdbcTemplate查询数据" class="headerlink" title="JdbcTemplate查询数据"></a>JdbcTemplate查询数据</h5><p>PS：jdbc为引入的JdbcTemplate</p>
<h6 id="查询单个对象"><a href="#查询单个对象" class="headerlink" title="查询单个对象"></a>查询单个对象</h6><ul>
<li><p>格式：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jdbc.queryForObject(<span class="string">&quot;sql语句&quot;</span>,RowMapper结果映射,参数<span class="number">1</span>,参数<span class="number">2.</span>...)</span><br></pre></td></tr></table></figure>
</li>
<li><p>返回单个对象</p>
</li>
</ul>
<h6 id="查询多个对象"><a href="#查询多个对象" class="headerlink" title="查询多个对象"></a>查询多个对象</h6><ul>
<li><p>格式:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jdbc.query(<span class="string">&quot;sql语句&quot;</span>,RowMapper结果映射,参数<span class="number">1</span>,参数<span class="number">2.</span>...)</span><br></pre></td></tr></table></figure>
</li>
<li><p>返回多个对象:Iterable&lt;对象&gt;</p>
</li>
</ul>
<h6 id="结果映射"><a href="#结果映射" class="headerlink" title="结果映射"></a>结果映射</h6><p>RowMapper结果映射：将结果集中的每行对象映射为一个对象.</p>
<p>本质是<strong>匿名内部类</strong>,处理方法:</p>
<ol>
<li><p>显式实现RowMapper(不推荐)</p>
</li>
<li><p>用java8的方法引用&#x2F;函数式编程</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Iterable&lt;Ingredient&gt; <span class="title function_">findAll</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">//this::mapRowToIngredient为函数式编程中的方法引用.</span></span><br><span class="line">        <span class="keyword">return</span> jdbc.query(<span class="string">&quot;select id,name,type from Ingredient&quot;</span>, <span class="built_in">this</span>::mapRowToIngredient);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//外部实现匿名内部类</span></span><br><span class="line"><span class="keyword">private</span> Ingredient <span class="title function_">mapRowToIngredient</span><span class="params">(ResultSet rs,<span class="type">int</span> rowNum)</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line"> <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Ingredient</span>(rs.getString(<span class="string">&quot;id&quot;</span>), rs.getString(<span class="string">&quot;name&quot;</span>), Ingredient.Type.valueOf(rs.getString(<span class="string">&quot;type&quot;</span>)));</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h5 id="JdbcTemplate插入数据"><a href="#JdbcTemplate插入数据" class="headerlink" title="JdbcTemplate插入数据"></a>JdbcTemplate插入数据</h5><ul>
<li><p>格式:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jdbc.update(<span class="string">&quot;sql语句参数位置用？符合&quot;</span>,参数<span class="number">1</span>,参数<span class="number">2</span>,...);</span><br></pre></td></tr></table></figure>
</li>
<li><p>返回一个对象</p>
</li>
<li><p>例子</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jdbcTemplate.update(<span class="string">&quot;insert into Taco_Ingredients(taco,ingredient) values(?,?)&quot;</span>,tacoId,ingredient.getId());</span><br></pre></td></tr></table></figure></li>
</ul>
<h5 id="使用SimpleJdbcInsert包装器类插入数据"><a href="#使用SimpleJdbcInsert包装器类插入数据" class="headerlink" title="使用SimpleJdbcInsert包装器类插入数据"></a>使用SimpleJdbcInsert包装器类插入数据</h5><p>插入数据并返回key</p>
<p>解决方法：</p>
<ol>
<li><p>直接使用JdbcTemplate的update()方法(太麻烦)</p>
</li>
<li><p>使用SimpleJdbcInsert包装器类</p>
</li>
<li><p><strong>引入SimpleJdbcInsert</strong></p>
<ul>
<li><p>将JdbcTemplate注入</p>
</li>
<li><p>构造SimpleJdbcInsert实例并注入JdbcTemplate</p>
</li>
<li><p>配置相关表</p>
</li>
<li><p>配置key(如果需要)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> SimpleJdbcInsert a;</span><br><span class="line"><span class="keyword">private</span> SimpleJdbcInsert b;</span><br><span class="line">     </span><br><span class="line"> <span class="keyword">public</span> <span class="title function_">JdbcOrderRepository</span><span class="params">(JdbcTemplate jdbcTemplate)</span> &#123;</span><br><span class="line">     </span><br><span class="line">     <span class="built_in">this</span>.a = <span class="keyword">new</span> <span class="title class_">SimpleJdbcInsert</span>(jdbcTemplate).withTableName(<span class="string">&quot;相关表&quot;</span>).usingGeneratedKeyColumns(<span class="string">&quot;主键&quot;</span>);</span><br><span class="line">     </span><br><span class="line">     <span class="built_in">this</span>.b = <span class="keyword">new</span> <span class="title class_">SimpleJdbcInsert</span>(jdbcTemplate).withTableName(<span class="string">&quot;相关表&quot;</span>);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong>使用SimpleJdbcInsert</strong></p>
<ul>
<li><p>b.execute(Map map)</p>
</li>
<li><p>a.execute(Map map).AndReturnKey()</p>
<p>返回Long类型 .longValue()</p>
</li>
<li><p>接收Map&lt;String,Object&gt;类型，key为数据库列名，value为插入实际值</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Map&lt;String, Object&gt; values = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">values.put(<span class="string">&quot;tacoOrder&quot;</span>, orderId);</span><br><span class="line">values.put(<span class="string">&quot;taco&quot;</span>, taco.getId());</span><br><span class="line"><span class="type">int</span> <span class="variable">execute</span> <span class="operator">=</span> orderTacoInserter.execute(values);</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ol>
<h5 id="预加载sql文件"><a href="#预加载sql文件" class="headerlink" title="预加载sql文件"></a>预加载sql文件</h5><p>配置文件</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.jpa.hibernate.ddl-auto</span>=<span class="string">none</span></span><br><span class="line"><span class="comment">#解决JPA自动按实体生成数据库而不加载数据库sql</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>默认路径:src&#x2F;main&#x2F;resources文件下</p>
<ul>
<li><p>修改路径</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#修改数据库路径</span></span><br><span class="line"><span class="attr">spring.datasource.schema</span>=<span class="string">classpath:sql/schema.sql</span></span><br><span class="line"><span class="comment">#修改预加载数据路径</span></span><br><span class="line"><span class="attr">spring.datasource.data</span>=<span class="string">classpath:sql/data.sql</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>加载数据库(默认文件名)schema.sql</p>
</li>
<li><p>预加载数据(默认文件名)data.sql</p>
</li>
</ul>
<h4 id="JPA重写数据Repository"><a href="#JPA重写数据Repository" class="headerlink" title="JPA重写数据Repository"></a>JPA重写数据Repository</h4><h5 id="什么是Spring-Data"><a href="#什么是Spring-Data" class="headerlink" title="什么是Spring Data"></a>什么是Spring Data</h5><p>Spring Data是一个大项目，它的子项目负责对不同的数据库类型进行数据持久化.</p>
<p>特性:</p>
<p>Spring Data 对所有项目提供<strong>基于repository规范接口自动生成repository的功能.</strong></p>
<ul>
<li>Spring Data JPA: 基于关系型数据库进行JPA持久化</li>
<li>Spring Data MongoDB:持久化到Mongo文档数据库</li>
<li>Spring Data Neo4j:持久化到Neo4j图数据库.</li>
<li>Spring Data Redis:持久化到Redis key-value存储</li>
<li>Spring Data Cassandra:持久化到Cassandra数据库.</li>
</ul>
<h5 id="添加相关依赖"><a href="#添加相关依赖" class="headerlink" title="添加相关依赖"></a>添加相关依赖</h5><h6 id="引入JPA"><a href="#引入JPA" class="headerlink" title="引入JPA"></a>引入JPA</h6><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-jpa<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>JPA是JAVA EE 5标准的ORM接口.</li>
<li>Hibernate是ORM框架.</li>
<li>JPA是标准接口，Hibernate是实现</li>
</ul>
<h5 id="将pojo类标注为实体"><a href="#将pojo类标注为实体" class="headerlink" title="将pojo类标注为实体"></a>将pojo类标注为实体</h5><h6 id="Entity"><a href="#Entity" class="headerlink" title="@Entity"></a>@Entity</h6><p>标记pojo类为实体类,采用默认ORM规则.</p>
<p>(类名&#x3D;表名,类属性名&#x3D;表字段名,可选择name&#x3D;‘“数据库名”)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table(name = &quot;abc&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GG</span>   &#123;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//代表GG类对应名为abc表,如果没有就指定名为GG的表</span></span><br></pre></td></tr></table></figure>

<p><strong>映射规则</strong>:</p>
<ol>
<li><p>实体类要@Entity(javax.persistence.Entity)</p>
</li>
<li><p>@id（javax.persistence.Id）注解一个主键</p>
</li>
<li><p>实体类必须要一个public&#x2F;protected的<strong>无参构造函数</strong></p>
</li>
<li><p>实体类不能是final类，也不能有final方法.</p>
</li>
<li><p>如果实体类的一个实例需要用传值的方式调用,则这个实体类需要继承Serializable接口.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table(name = &quot;Taco_Order&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Order</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> serialVersionUID=<span class="number">1L</span>;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue(strategy = GenerationType.AUTO)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">   ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h6 id="Table"><a href="#Table" class="headerlink" title="@Table"></a>@Table</h6><ul>
<li>直接指定实体类对应哪一个表</li>
<li>优先级：@Table &gt; @Entity</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table(name = &quot;bcd&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">abc</span>&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h6 id="column"><a href="#column" class="headerlink" title="@column"></a><strong>@column</strong></h6><ul>
<li>直接指定类<strong>属性</strong>对应数据库哪一个字段</li>
<li><strong>name&#x3D;</strong>‘字段名’</li>
<li><strong>unique</strong>：字段是否唯一</li>
<li><strong>nullable</strong>：字段是否空</li>
<li><strong>length</strong>：字段长度</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">abc</span>&#123;</span><br><span class="line"><span class="meta">@Column(name = &quot;createdat&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Date createdAt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h6 id="ID"><a href="#ID" class="headerlink" title="@ID"></a>@ID</h6><ul>
<li>标记改属性为主键</li>
</ul>
<h6 id="GeneratedValue-strategy-x3D-主键生成模式"><a href="#GeneratedValue-strategy-x3D-主键生成模式" class="headerlink" title="@GeneratedValue(strategy &#x3D; 主键生成模式)"></a>@GeneratedValue(strategy &#x3D; 主键生成模式)</h6><ul>
<li><strong>AUTO</strong>：主键由程序控制，是默认选项，不设置即此项</li>
<li><strong>IDENTITY</strong>（一般使用这个)：主键由数据库自动生成（Oracle不支持这种方式）</li>
<li><strong>SEQUENCE</strong>：通过数据库的序列产生主键(数据库不支持自增)，通过@SequenceGenerator 注解指定序列名，mysql不支持这种方式</li>
<li><strong>TABLE</strong>：通过特定的数据库表产生主键，易于数据库移植.</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">abc</span>&#123;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">long</span> id;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="实体类中的命名策略-以-Entity-为例子"><a href="#实体类中的命名策略-以-Entity-为例子" class="headerlink" title="实体类中的命名策略(以@Entity  为例子)"></a>实体类中的命名策略(以@Entity  为例子)</h5><p>PS:@Table和@column也一样</p>
<p>差不多按照驼峰命名法</p>
<ul>
<li><p>全变成小写</p>
</li>
<li><p>当遇到第二个字母大写则前面加下划线</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BoxAplle</span>&#123;...&#125; 表名 box_apple  </span><br><span class="line"><span class="meta">@Entity(name=&quot;BA&quot;)</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BoxApple</span>&#123;...&#125; 表名 ba  </span><br><span class="line"><span class="meta">@Entity(name=&quot;BoApple&quot;)</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BoxApple</span>&#123;...&#125; 表名 bo_apple </span><br><span class="line"><span class="meta">@Entity(name=&quot;boxapple&quot;)</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BoxApple</span>&#123;...&#125; 表名 boxapple</span><br></pre></td></tr></table></figure></li>
</ul>
<h5 id="相关注解"><a href="#相关注解" class="headerlink" title="相关注解"></a>相关注解</h5><h6 id="PrePersist"><a href="#PrePersist" class="headerlink" title="@PrePersist"></a>@PrePersist</h6><p>在上传实体前调用这个注解下的方法.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PrePersist</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">createAt</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.createdAt=<span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h6 id="OneToMany"><a href="#OneToMany" class="headerlink" title="@OneToMany"></a>@OneToMany</h6><p>一对多</p>
<ul>
<li><p>外键关联</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//两个实体类一个有主键(1)，一个有外键(多)</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table(name=&quot;1的表&quot;)</span></span><br><span class="line"><span class="keyword">public</span> class <span class="number">1</span>的类名 <span class="keyword">implements</span> <span class="title class_">java</span>.io.Serializable &#123;</span><br><span class="line">  <span class="meta">@OneToMany(cascade=&#123; CascadeType.ALL &#125;)</span></span><br><span class="line">  <span class="meta">@JoinColumn(name=&quot;在多的表建新列来指向1的主键&quot;)</span></span><br><span class="line">  <span class="keyword">private</span> Collection&lt;多的类型&gt; addresses = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;多的类型&gt;();</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


</li>
<li><p>表关联(多一个表关联两个表)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table(name = &quot;1的表&quot;)</span></span><br><span class="line"><span class="keyword">public</span> class <span class="number">1</span>的类名 <span class="keyword">implements</span> <span class="title class_">java</span>.io.Serializable &#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="meta">@OneToMany(cascade = &#123; CascadeType.ALL &#125;)</span></span><br><span class="line">  <span class="meta">@JoinTable(name=&quot;关联用的表&quot;,</span></span><br><span class="line"><span class="meta">  joinColumns=&#123; @JoinColumn(name=&quot;在多的表建新列来指向1的主键&quot;,referencedColumnName=&quot;1的主键&quot;)&#125;,</span></span><br><span class="line"><span class="meta"> inverseJoinColumns=&#123;@JoinColumn(name=&quot;在多的表建新列来指向1的主键&quot;,referencedColumnName=&quot;1的主键&quot;)&#125;)</span></span><br><span class="line">  <span class="keyword">private</span> Collection&lt;多的类型&gt; addresses = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;多的类型&gt;();</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>默认关联(直接数据库外键)</p>
</li>
</ul>
<h6 id="ManyToOne"><a href="#ManyToOne" class="headerlink" title="@ManyToOne"></a>@ManyToOne</h6><p>多对一</p>
<ul>
<li><p>外键关联</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table(name=&quot;多的类表&quot;)</span></span><br><span class="line"><span class="keyword">public</span> class 多的类 <span class="keyword">implements</span> <span class="title class_">java</span>.io.Serializable &#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@ManyToOne(cascade = &#123; CascadeType.ALL &#125;)</span></span><br><span class="line">  <span class="meta">@JoinColumn(name=&quot;在多的表建新列来指向1的主键&quot;)</span></span><br><span class="line">  <span class="keyword">private</span> <span class="number">1</span>的类 customer;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>默认关联(直接数据库外键)</p>
</li>
</ul>
<h6 id="ManyToMany"><a href="#ManyToMany" class="headerlink" title="@ManyToMany"></a>@ManyToMany</h6><p>多对多（其他用法和一对多类似）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ManyToMany(targetEntity = Guo.class)</span></span><br><span class="line"><span class="keyword">private</span> List&lt;Guo&gt; guos=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br></pre></td></tr></table></figure>



<h6 id="Transient"><a href="#Transient" class="headerlink" title="@Transient"></a>@Transient</h6><p>这个属性不会被持久化</p>
<h6 id="OneToOne，-OneToMany，-ManyToMany中mappedBy双向关联问题"><a href="#OneToOne，-OneToMany，-ManyToMany中mappedBy双向关联问题" class="headerlink" title="@OneToOne，@OneToMany，@ManyToMany中mappedBy双向关联问题"></a>@OneToOne，@OneToMany，@ManyToMany中mappedBy双向关联问题</h6><ol>
<li>@OneToMany(mapped&#x3D;“<strong>由One的一方指向Many的一方，并且，这个属性应该等于Many的一方中含有One类的属性的属性名</strong> ”)</li>
<li>如果我们没有填mapped这个属性，则会产生第三张表，这一张表是用来管理这两张表的</li>
<li><strong>mappedBy不能用在@ManyToOne</strong></li>
<li><strong>使用mapperBy的类为主维护者</strong>(当这个类不为空时，另一个类可空可不空，但当这个类为空时，另一个类一定是空)</li>
</ol>
<h5 id="声明-JPA-repository"><a href="#声明-JPA-repository" class="headerlink" title="声明 JPA repository"></a>声明 JPA repository</h5><h6 id="使用步骤"><a href="#使用步骤" class="headerlink" title="使用步骤"></a>使用步骤</h6><ol>
<li>通过让Repository接口继承<strong>CrudRepository</strong>接口，</li>
<li>来让Spring Data JPA 自动生成实现类,然后调用这些repository，</li>
<li>再注入到Controller层实现各种CRUD(创建，读取，更新，删除)</li>
</ol>
<h6 id="Repository接口格式"><a href="#Repository接口格式" class="headerlink" title="Repository接口格式:"></a>Repository接口格式:</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> interface 接口名 <span class="keyword">extends</span> <span class="title class_">CrudRepository</span>&lt;持久化的实体类型, 实体ID属性的类型&gt; &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="Controller调用"><a href="#Controller调用" class="headerlink" title="Controller调用"></a>Controller调用</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">接口名.已经写好的CRUD方法()</span><br></pre></td></tr></table></figure>

<h6 id="分页访问"><a href="#分页访问" class="headerlink" title="分页访问"></a>分页访问</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">接口名.查询方法(<span class="keyword">new</span> <span class="title class_">PageRequest</span>(开始, 结束))</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PagingAndSortingRepository&lt;User, Long&gt; repository = <span class="comment">// … get access to a bean</span></span><br><span class="line">Page&lt;User&gt; users = repository.findAll(<span class="keyword">new</span> <span class="title class_">PageRequest</span>(<span class="number">1</span>, <span class="number">20</span>));</span><br></pre></td></tr></table></figure>



<h5 id="自定义-JPA-repository"><a href="#自定义-JPA-repository" class="headerlink" title="自定义 JPA repository"></a>自定义 JPA repository</h5><p>处理上面处理不了的问题，有细节的操作.(在接口中定义相关更细节的处理方式)</p>
<h6 id="Query"><a href="#Query" class="headerlink" title="@Query"></a>@Query</h6><ul>
<li><p><strong>执行原生SQL</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserRepository</span> <span class="keyword">extends</span> <span class="title class_">JpaRepository</span>&lt;User, Long&gt; &#123;</span><br><span class="line">    <span class="comment">//注意要设置nativeQuery = true</span></span><br><span class="line">    <span class="comment">//注意参数要？1 ?2 ?3 ...</span></span><br><span class="line">  <span class="meta">@Query(value = &quot;SELECT * FROM USERS WHERE EMAIL_ADDRESS = ?1&quot;, nativeQuery = true)</span></span><br><span class="line">  User <span class="title function_">findByEmailAddress</span><span class="params">(String emailAddress)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>使用SQL并且带自定义名称</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserRepository</span> <span class="keyword">extends</span> <span class="title class_">JpaRepository</span>&lt;User, Long&gt; &#123;</span><br><span class="line"><span class="comment">//sql列中位置要用  ：列名</span></span><br><span class="line"><span class="comment">//参数要用@Param(&quot;列名&quot;)</span></span><br><span class="line">  <span class="meta">@Query(&quot;select u from User u where u.firstname = :firstname or u.lastname = :lastname&quot;)</span></span><br><span class="line">  User <span class="title function_">findByLastnameOrFirstname</span><span class="params">(<span class="meta">@Param(&quot;lastname&quot;)</span> String lastname,</span></span><br><span class="line"><span class="params">                                 <span class="meta">@Param(&quot;firstname&quot;)</span> String firstname)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>实现排序查询</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Spring Data JPA拒绝Order包含函数调用的任何实例</span></span><br><span class="line"><span class="comment">//参数会多一个Sort类型</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserRepository</span> <span class="keyword">extends</span> <span class="title class_">JpaRepository</span>&lt;User, Long&gt; &#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Query(&quot;select u from User u where u.lastname like ?1%&quot;)</span></span><br><span class="line">  List&lt;User&gt; <span class="title function_">findByAndSort</span><span class="params">(String lastname, Sort sort)</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//Controller层调用</span></span><br><span class="line"><span class="comment">//new Sort(&quot;查询列名&quot;)</span></span><br><span class="line">repo.findByAsArrayAndSort(<span class="string">&quot;bolton&quot;</span>, <span class="keyword">new</span> <span class="title class_">Sort</span>(<span class="string">&quot;fn_len&quot;</span>));              </span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>实现分页查询</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//value=&quot;sql&quot;</span></span><br><span class="line"><span class="comment">//countQuery=&quot;统计sql行数&quot;</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserRepository</span> <span class="keyword">extends</span> <span class="title class_">JpaRepository</span>&lt;User, Long&gt; &#123;</span><br><span class="line">  <span class="meta">@Query(value = &quot;SELECT * FROM USERS WHERE LASTNAME = ?1&quot;,</span></span><br><span class="line"><span class="meta">    countQuery = &quot;SELECT count(*) FROM USERS WHERE LASTNAME = ?1&quot;,</span></span><br><span class="line"><span class="meta">    nativeQuery = true)</span></span><br><span class="line">  Page&lt;User&gt; <span class="title function_">findByLastname</span><span class="params">(String lastname, Pageable pageable)</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//Controlller层调用</span></span><br><span class="line">UserRepository.findByLastname(参数,<span class="keyword">new</span> <span class="title class_">PageRequest</span>(开始, 结束))</span><br></pre></td></tr></table></figure></li>
</ul>
<h6 id="领域特定语言-DSL"><a href="#领域特定语言-DSL" class="headerlink" title="领域特定语言(DSL)"></a>领域特定语言(DSL)</h6><ul>
<li><p>原理：Spring Data直接检查repository接口的所有方法并解析方法名称.</p>
</li>
<li><p>格式：</p>
<ol>
<li><p>一个动词</p>
<ul>
<li>get &#x2F; read &#x2F; find</li>
<li>count返回int</li>
</ul>
</li>
<li><p>一个可选主题</p>
<ul>
<li>不写则默认本实体中的数据库</li>
<li>写就指定</li>
</ul>
</li>
<li><p>关键词By</p>
</li>
<li><p>一个断言（字段名）</p>
</li>
<li><p>操作符</p>
<p><img src="D:\TyporaOfimage\615156-20160131220456193-145289785.png" alt="img"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//例子</span></span><br><span class="line">readOrdersByDeliveryZipAndPlacedAtBetween();</span><br><span class="line"><span class="comment">//read=读取</span></span><br><span class="line"><span class="comment">//Orders=数据库</span></span><br><span class="line"><span class="comment">//By关键词</span></span><br><span class="line"><span class="comment">//DeliveryZip=字段名deliveryZip或者delivery.zip</span></span><br><span class="line"><span class="comment">//PlacedAt=字段名placedAt或者placed.at</span></span><br><span class="line"><span class="comment">//Between=PlacedAt的范围</span></span><br></pre></td></tr></table></figure></li>
</ol>
</li>
</ul>
<h4 id="ModelAttribute运用"><a href="#ModelAttribute运用" class="headerlink" title="@ModelAttribute运用"></a>@ModelAttribute运用</h4><h5 id="类运用"><a href="#类运用" class="headerlink" title="类运用"></a>类运用</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SessionAttributes(value =&#123;&quot;name&quot;,&quot;name1&quot;,...&#125; )</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">a</span>&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h6><p>将名为name的ModelAttribute保存在Session实现跨域访问.</p>
<h6 id="记得重置Session"><a href="#记得重置Session" class="headerlink" title="记得重置Session"></a>记得重置Session</h6><p>引入参数SessionStatus，然后调用其中的方法.setComplete()  来重置Session</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> String <span class="title function_">processOrder</span><span class="params">(<span class="meta">@Valid</span> Order order, Errors errors, SessionStatus sessionStatus)</span> &#123;</span><br><span class="line">    sessionStatus.setComplete();</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;redirect:/&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="方法运用"><a href="#方法运用" class="headerlink" title="方法运用"></a>方法运用</h5><p>访问Controller中的链接时，<strong>优先执行</strong>@ModelAttribute的方法。但是当一个Controller类有多个链接,要小心生成的model.</p>
<ol>
<li><p>无返回值方法@ModelAttribute</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ModelAttribute</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">order</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">//相当于一个可以优先使用的方法，一般用来先将参数放入model</span></span><br><span class="line">    <span class="comment">//model.addAttribute(&quot;名字&quot;, 参数);</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>有返回值方法@ModelAttribute</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ModelAttribute</span></span><br><span class="line"><span class="keyword">public</span> Order <span class="title function_">order</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Order</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//相当于优先执行model.addAttribute(&quot;order&quot;, new Order());</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>有返回值方法@ModelAttribute(value&#x3D;”name”)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ModelAttribute(name=&quot;abc&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Order <span class="title function_">order</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Order</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//相当于优先执行model.addAttribute(&quot;abc&quot;, new Order());</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h5 id="参数运用"><a href="#参数运用" class="headerlink" title="参数运用"></a>参数运用</h5><ol>
<li><p><strong>从Model上获取@Controller</strong><br>public class HelloWorldController {</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ModelAttribute(&quot;a&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Order <span class="title function_">addAccount</span><span class="params">()</span> &#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Order</span>(<span class="string">&quot;1&quot;</span>,<span class="string">&quot;2&quot;</span>);</span><br><span class="line">    <span class="comment">//在model生成&#123;key=&#x27;a&#x27;,value=Order对象&#125;</span></span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line"><span class="meta">@RequestMapping(value = &quot;/helloWorld&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">helloWorld</span><span class="params">(<span class="meta">@ModelAttribute(&quot;a&quot;)</span> Order order)</span> &#123;</span><br><span class="line">    <span class="comment">//相当于从model获得key=&#x27;a&#x27;的数据</span></span><br><span class="line">   <span class="keyword">return</span> <span class="string">&quot;helloWorld&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">   </span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>从表单Form&#x2F;URL路径参数获得</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(value = &quot;/helloWorld&quot;)</span></span><br><span class="line">       <span class="keyword">public</span> String <span class="title function_">helloWorld</span><span class="params">(<span class="meta">@ModelAttribute(&quot;a&quot;)</span> User user)</span> &#123;</span><br><span class="line">           <span class="comment">//从表单获得a对象</span></span><br><span class="line">          <span class="keyword">return</span> <span class="string">&quot;helloWorld&quot;</span>;</span><br><span class="line">       &#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="保护Spring"><a href="#保护Spring" class="headerlink" title="保护Spring"></a>保护Spring</h3><h4 id="引入Spring-Security"><a href="#引入Spring-Security" class="headerlink" title="引入Spring Security"></a>引入Spring Security</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-security<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="引入后获得的安全特性"><a href="#引入后获得的安全特性" class="headerlink" title="引入后获得的安全特性"></a>引入后获得的安全特性</h5><ul>
<li><p><strong>所有的HTTP请求路径都需要认证</strong></p>
</li>
<li><p><strong>不需要特定的角色和权限</strong></p>
</li>
<li><p><strong>没有登陆页面</strong></p>
</li>
<li><p><strong>认证过程是通过HTTP basic认证对话框实现的</strong></p>
</li>
<li><p><strong>系统只有一个用户user</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//密码在输出框中显示</span></span><br><span class="line">Using <span class="keyword">default</span> security password: <span class="number">60</span>位加密密码...</span><br></pre></td></tr></table></figure></li>
</ul>
<h5 id="显式配置可覆盖掉自动配置"><a href="#显式配置可覆盖掉自动配置" class="headerlink" title="显式配置可覆盖掉自动配置"></a>显式配置可覆盖掉自动配置</h5><p>如果实现来了下面配置Spring Security，上面的部分特性会被覆盖掉.</p>
<h4 id="配置Spring-Security"><a href="#配置Spring-Security" class="headerlink" title="配置Spring Security"></a>配置Spring Security</h4><ol>
<li><p>新生成安全配置类</p>
</li>
<li><p>继承<strong>WebSecurityConfigurerAdapter</strong>接口</p>
</li>
<li><p>添加类级别**@Configuration**</p>
</li>
<li><p>添加类级别**@EnableWebSecurity**来启动安全配置</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableWebSecurity</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SecurityConfig</span> <span class="keyword">extends</span> <span class="title class_">WebSecurityConfigurerAdapter</span> &#123;</span><br><span class="line">...</span><br><span class="line">    <span class="comment">//用户存储以及保护web请求，跨站攻击的具体配置</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="用户存储"><a href="#用户存储" class="headerlink" title="用户存储"></a>用户存储</h4><ol>
<li><p>安全配置类实现<strong>WebSecurityConfigurerAdapter</strong>接口</p>
</li>
<li><p>重写<strong>configure</strong>(AuthenticationManagerBuilder auth)方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableWebSecurity</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SecurityConfig</span> <span class="keyword">extends</span> <span class="title class_">WebSecurityConfigurerAdapter</span> &#123;</span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    ...</span><br><span class="line">        <span class="comment">//具体用户存储配置</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h5 id="基于内存"><a href="#基于内存" class="headerlink" title="基于内存"></a>基于内存</h5><h6 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h6><ol>
<li>应用于测试&#x2F;简单应用</li>
<li>用户信息数量有限且不会发送变化</li>
</ol>
<h6 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h6><ol>
<li>难以编辑用户</li>
<li>要重新构建和部署应用</li>
</ol>
<h6 id="具体使用"><a href="#具体使用" class="headerlink" title="具体使用"></a>具体使用</h6><ol>
<li><p>调用AuthenticationManagerBuilder中的<strong>inMemoryAuthentication</strong>方法</p>
</li>
<li><p>配置用户<strong>withUser(“用户名”)</strong></p>
</li>
<li><p>配置密码<strong>password(“{noop}密码”)</strong></p>
<ul>
<li><strong>用户不加密的密码</strong>必须前面加{noop}</li>
<li>用户加密的密码不用</li>
</ul>
</li>
<li><p>配置权限<strong>authorities(“ROLE_权限名”)</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    auth.inMemoryAuthentication()</span><br><span class="line">            .withUser(<span class="string">&quot;buzz&quot;</span>)</span><br><span class="line">            .password(<span class="string">&quot;&#123;noop&#125;abc123456&quot;</span>)</span><br><span class="line">            .authorities(<span class="string">&quot;ROLE_USER&quot;</span>)</span><br><span class="line">            .and()</span><br><span class="line">            .withUser(<span class="string">&quot;abc&quot;</span>)</span><br><span class="line">            .password(<span class="string">&quot;&#123;noop&#125;abc&quot;</span>)</span><br><span class="line">            .authorities(<span class="string">&quot;ROLE_USER&quot;</span>);</span><br><span class="line">    <span class="comment">//配置了用户buzz 密码abc123456 权限ROLE_USER</span></span><br><span class="line">    <span class="comment">//配置了用户abc 密码abc 权限ROLE_USER</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h5 id="基于JDBC"><a href="#基于JDBC" class="headerlink" title="基于JDBC"></a>基于JDBC</h5><h6 id="优点-1"><a href="#优点-1" class="headerlink" title="优点"></a>优点</h6><ol>
<li>直接使用关系型数据库</li>
</ol>
<h6 id="缺点-1"><a href="#缺点-1" class="headerlink" title="缺点"></a>缺点</h6><ol>
<li>对比LDAP会慢点</li>
</ol>
<h6 id="默认用户使用方法"><a href="#默认用户使用方法" class="headerlink" title="默认用户使用方法"></a>默认用户使用方法</h6><ol>
<li><p>注入<strong>DataSource</strong></p>
</li>
<li><p>调用<strong>AuthenticationManagerBuilder</strong>中的<strong>jdbcAuthentication</strong>()方法</p>
</li>
<li><p>调用<strong>dataSource</strong>(注入DataSource)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> DataSource dataSource;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    auth.jdbcAuthentication()</span><br><span class="line">            .dataSource(dataSource);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>默认有用户查询功能（但是数据库要按它的要求建立）(了解即可)</p>
<ol>
<li><p>查找用户的<strong>用户名</strong>,<strong>密码</strong>,<strong>是否启用的信息</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DEF_USERS_BY_USERNAME_QUERY</span> <span class="operator">=</span> <span class="string">&quot;select username,password,enabled from users where username = ?&quot;</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>查找用户<strong>所授予的权限</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DEF_AUTHORITIES_BY_USERNAME_QUERY</span> <span class="operator">=</span> <span class="string">&quot;select username,authority from authorities where username = ?&quot;</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>查找用户所在<strong>群组id，群组名，所授予的权限</strong>.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DEF_GROUP_AUTHORITIES_BY_USERNAME_QUERY</span> <span class="operator">=</span> <span class="string">&quot;select g.id, g.group_name, ga.authority from groups g, group_members gm, group_authorities ga where gm.username = ? and g.id = ga.group_id and g.id = gm.group_id&quot;</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>路径</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">org/springframework/security/core/userdetails/jdbc/JdbcDaoImpl</span><br></pre></td></tr></table></figure></li>
</ol>
</li>
</ol>
<h6 id="自定义用户使用方法"><a href="#自定义用户使用方法" class="headerlink" title="自定义用户使用方法"></a>自定义用户使用方法</h6><ol>
<li>接着上面的</li>
<li>（可选）重写<strong>认证</strong>的查询语句<strong>usersByUsernameQuery()</strong><ul>
<li>参数:用户名username</li>
<li>用户名username</li>
<li>密码password</li>
<li>启用状态信息enabled</li>
</ul>
</li>
<li>（可选）重写<strong>基本权限</strong>的查询语句<strong>authoritiesByUsernameQuery</strong>()<ul>
<li>参数:用户名username</li>
<li>用户名username</li>
<li>权限authority</li>
</ul>
</li>
<li>（可选）重写<strong>群组权限</strong>的查询语句<strong>groupAuthoritiesByUsername</strong>()<ul>
<li>参数:用户名username</li>
<li>群组id</li>
<li>群组名group_name</li>
<li>所在群组权限authority</li>
</ul>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> DataSource dataSource;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">   auth.jdbcAuthentication()</span><br><span class="line">                .dataSource(dataSource)</span><br><span class="line">                .usersByUsernameQuery(<span class="string">&quot;select username,password,enabled from MyUsers &quot;</span> +</span><br><span class="line">                        <span class="string">&quot;where username=?&quot;</span>)</span><br><span class="line">                .authoritiesByUsernameQuery(<span class="string">&quot;select username, authority from UserAuthorities &quot;</span> +</span><br><span class="line">                        <span class="string">&quot;where username=?&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>PS：里面填的sql的条件和查询结果列一定要一致.</p>
<h6 id="密码转码器"><a href="#密码转码器" class="headerlink" title="密码转码器"></a>密码转码器</h6><p><img src="D:\TyporaOfimage\密码转换器.png" alt="密码转换器"></p>
<p><strong>使用方法</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.passwordEncode(加密模块对象)</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> DataSource dataSource;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">   auth.jdbcAuthentication()</span><br><span class="line">                .dataSource(dataSource)</span><br><span class="line">      .usersByUsernameQuery(<span class="string">&quot;select username,password,enabled from MyUsers &quot;</span> +<span class="string">&quot;where username=?&quot;</span>)</span><br><span class="line">        .authoritiesByUsernameQuery(<span class="string">&quot;select username, authority from UserAuthorities &quot;</span> +</span><br><span class="line">                        <span class="string">&quot;where username=?&quot;</span>)</span><br><span class="line">       .passwordEncoder(<span class="keyword">new</span> <span class="title class_">BCryptPasswordEncoder</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p><strong>加密模块</strong></p>
<ul>
<li>BCryptPasswordEncoder：使用bcrypt强哈希加密</li>
<li>Pbkdf2PasswordEncoder：使用PBKDF2加密</li>
<li>SCryptPasswordEncoder：使用scrypt加密</li>
</ul>
<p><strong>自定义加密模块</strong></p>
<p>实现PasswordEncoder接口</p>
<h5 id="以LDAP作为后端"><a href="#以LDAP作为后端" class="headerlink" title="以LDAP作为后端"></a>以LDAP作为后端</h5><p>LDAP(Lightweight Directory Access Protocol,轻量级目录访问协议)</p>
<h6 id="简单使用"><a href="#简单使用" class="headerlink" title="简单使用"></a>简单使用</h6><ol>
<li><p>调用<strong>AuthenticationManagerBuilder</strong>中的<strong>ldapAuthentication</strong>()方法</p>
</li>
<li><p>指定用户查询基础<strong>userSearchBase</strong>(默认从LDIF文件根开始)—–指定从哪里开始查</p>
</li>
<li><p>为LDAP查询提供过滤条件<strong>userSearchFilter</strong></p>
</li>
<li><p>同理有<strong>groupSearchBase</strong>，<strong>groupSearchFilter</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">       auth</span><br><span class="line">               .ldapAuthentication()</span><br><span class="line">               .userSearchBase(<span class="string">&quot;ou=people&quot;</span>)</span><br><span class="line">               .userSearchFilter(<span class="string">&quot;(uid=&#123;0&#125;)&quot;</span>)</span><br><span class="line">               .groupSearchBase(<span class="string">&quot;ou=groups&quot;</span>)</span><br><span class="line">               .groupSearchFilter(<span class="string">&quot;member=&#123;0&#125;&quot;</span>);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h6 id="配置密码比对"><a href="#配置密码比对" class="headerlink" title="配置密码比对"></a>配置密码比对</h6><p>LDAP认证策略</p>
<ul>
<li><strong>绑定操作(默认)</strong>:直接通过LDAP服务器认证用户</li>
<li><strong>比对操作</strong>：在LDAP服务器内直接对比密码<ul>
<li>调用<strong>passwordCompare</strong>()进行比对</li>
<li><strong>比对属性</strong><ul>
<li><strong>userPassword</strong>属性（默认）</li>
<li>调用<strong>passwordAttribute</strong>（”属性名“）指定属性</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        auth</span><br><span class="line">                .ldapAuthentication()</span><br><span class="line">                .userSearchBase(<span class="string">&quot;ou=people&quot;</span>)</span><br><span class="line">                .userSearchFilter(<span class="string">&quot;(uid=&#123;0&#125;)&quot;</span>)</span><br><span class="line">                .groupSearchBase(<span class="string">&quot;ou=groups&quot;</span>)</span><br><span class="line">                .groupSearchFilter(<span class="string">&quot;member=&#123;0&#125;&quot;</span>)</span><br><span class="line">                .passwordCompare()</span><br><span class="line">            <span class="comment">//实现密码比对</span></span><br><span class="line">                .passwordEncoder(<span class="keyword">new</span> <span class="title class_">BCryptPasswordEncoder</span>())</span><br><span class="line">            <span class="comment">//实现加密</span></span><br><span class="line">                .passwordAttribute(<span class="string">&quot;passcode&quot;</span>);</span><br><span class="line">            <span class="comment">//指定LDAP服务器内的密码属性</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<h6 id="应用远程LDAP服务器"><a href="#应用远程LDAP服务器" class="headerlink" title="应用远程LDAP服务器"></a>应用远程LDAP服务器</h6><ul>
<li>用and()分开其他配置</li>
<li>调用<strong>contextSource</strong>()</li>
<li>调用<strong>url</strong>(“远程地址”)设置LDAP服务器地址</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        auth</span><br><span class="line">                .ldapAuthentication()</span><br><span class="line">                .userSearchBase(<span class="string">&quot;ou=people&quot;</span>)</span><br><span class="line">                .userSearchFilter(<span class="string">&quot;(uid=&#123;0&#125;)&quot;</span>)</span><br><span class="line">                .groupSearchBase(<span class="string">&quot;ou=groups&quot;</span>)</span><br><span class="line">                .groupSearchFilter(<span class="string">&quot;member=&#123;0&#125;&quot;</span>)</span><br><span class="line">                .passwordCompare()</span><br><span class="line">                .passwordEncoder(<span class="keyword">new</span> <span class="title class_">BCryptPasswordEncoder</span>())</span><br><span class="line">                .passwordAttribute(<span class="string">&quot;userPassword&quot;</span>)</span><br><span class="line">                .and()</span><br><span class="line">            <span class="comment">//分开其他配置</span></span><br><span class="line">               .contextSource()</span><br><span class="line">                .url(<span class="string">&quot;ldap://tacocloud.com:33389/dc=tacoloud,dc=com&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h6 id="配置嵌入式的LDAP服务器"><a href="#配置嵌入式的LDAP服务器" class="headerlink" title="配置嵌入式的LDAP服务器"></a>配置嵌入式的LDAP服务器</h6><ul>
<li>and()分开其他配置</li>
<li>调用<strong>contextSource</strong>()</li>
<li>调用<strong>root</strong>(“根前缀”)</li>
<li>指定<strong>LDIF</strong>文件<strong>ldif</strong>(“classpath:resources路径”)</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        auth</span><br><span class="line">                .ldapAuthentication()</span><br><span class="line">                .userSearchBase(<span class="string">&quot;ou=people&quot;</span>)</span><br><span class="line">                .userSearchFilter(<span class="string">&quot;(uid=&#123;0&#125;)&quot;</span>)</span><br><span class="line">                .groupSearchBase(<span class="string">&quot;ou=groups&quot;</span>)</span><br><span class="line">                .groupSearchFilter(<span class="string">&quot;member=&#123;0&#125;&quot;</span>)</span><br><span class="line">                .passwordCompare()</span><br><span class="line">                .passwordEncoder(<span class="keyword">new</span> <span class="title class_">BCryptPasswordEncoder</span>())</span><br><span class="line">                .passwordAttribute(<span class="string">&quot;userPassword&quot;</span>)</span><br><span class="line">                .and()</span><br><span class="line">                .contextSource()</span><br><span class="line">                .root(<span class="string">&quot;dc=tacocloud,dc=com&quot;</span>)</span><br><span class="line">                .ldif(<span class="string">&quot;classpath:users.ldif&quot;</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>PS：<strong>LDIF</strong>(LDAP数据交换形式)</p>
<h5 id="自定义用户认证"><a href="#自定义用户认证" class="headerlink" title="自定义用户认证"></a>自定义用户认证</h5><p>持久化用户数据</p>
<h6 id="定义用户领域对象和持久化"><a href="#定义用户领域对象和持久化" class="headerlink" title="定义用户领域对象和持久化"></a>定义用户领域对象和持久化</h6><ol>
<li><p>创建User类</p>
</li>
<li><p>类级别</p>
<ul>
<li>@Entity</li>
<li>@Data</li>
<li>@RequiredArgsConstructor</li>
<li>@NoArgsConstructor(access &#x3D; AccessLevel.PRIVATE,force &#x3D; true)</li>
</ul>
</li>
<li><p>继承<strong>UserDetails</strong>接口</p>
</li>
<li><p>重写方法</p>
<ul>
<li><p>用户权限集（默认需要添加”ROLE_”前缀）<strong>getAuthorities</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Collection&lt;? <span class="keyword">extends</span> <span class="title class_">GrantedAuthority</span>&gt; getAuthorities() &#123;</span><br><span class="line">    <span class="keyword">return</span> Arrays.asList(<span class="keyword">new</span> <span class="title class_">SimpleGrantedAuthority</span>(<span class="string">&quot;ROLE_USER&quot;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>账号是否过期<strong>isAccountNonExpired</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isAccountNonExpired</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>账号是否锁定<strong>isAccountNonLocked</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isAccountNonLocked</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>凭证是否过期<strong>isCredentialsNonExpired</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isCredentialsNonExpired</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>用户是否可用<strong>isEnabled</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isEnabled</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>实现<strong>repository</strong>接口,并且定义<strong>findByUsername</strong>()方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserRepository</span> <span class="keyword">extends</span> <span class="title class_">CrudRepository</span>&lt;User,Long&gt; &#123;</span><br><span class="line">    User <span class="title function_">findByUsername</span><span class="params">(String username)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h6 id="创建用户服务"><a href="#创建用户服务" class="headerlink" title="创建用户服务"></a>创建用户服务</h6><ol>
<li><p>创建服务类</p>
</li>
<li><p>添加类注解**@Service**</p>
</li>
<li><p>类继承<strong>UserDetailsService</strong></p>
</li>
<li><p>注入<strong>UserRepository</strong>类</p>
</li>
<li><p>重写<strong>loadUserByUsername</strong>方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserRepositoryUserDetailsService</span> <span class="keyword">implements</span> <span class="title class_">UserDetailsService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> UserRepository userRepository;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UserRepositoryUserDetailsService</span><span class="params">(UserRepository userRepository)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.userRepository = userRepository;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> UserDetails <span class="title function_">loadUserByUsername</span><span class="params">(String username)</span> <span class="keyword">throws</span> UsernameNotFoundException &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">byUsername</span> <span class="operator">=</span> userRepository.findByUsername(username);</span><br><span class="line">        <span class="comment">//当byUsername不为空====&gt;返回User对象</span></span><br><span class="line">        <span class="keyword">if</span>(byUsername!=<span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> byUsername;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">throw</span>  <span class="keyword">new</span> <span class="title class_">UsernameNotFoundException</span>(<span class="string">&quot;User &#x27;&quot;</span>+username+<span class="string">&quot;&#x27; not found&quot;</span>);</span><br><span class="line">        <span class="comment">//当byUsername为空 抛出错误</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>回到Spring Security配置类中的<strong>configure</strong>（）方法</p>
</li>
<li><p>注入<strong>UserDetailsService</strong></p>
</li>
<li><p>在configure调用<strong>userDetailsService</strong>()方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> UserDetailsService userDetailsService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">    auth</span><br><span class="line">            .userDetailsService(userDetailsService);           </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置密码转码器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">    auth</span><br><span class="line">            .userDetailsService(userDetailsService)</span><br><span class="line">            .passwordEncoder(encoder());</span><br><span class="line">    <span class="comment">//对于encoder()的任何调用都会被拦截,并返回应用上下文中的bean实例</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> PasswordEncoder <span class="title function_">encoder</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">BCryptPasswordEncoder</span>();</span><br><span class="line">    <span class="comment">//注册一个名为encoder的bean实例 返回PasswordEncoder对象</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h6 id="注册用户"><a href="#注册用户" class="headerlink" title="注册用户"></a>注册用户</h6><ol>
<li><p>创建用户表单类</p>
</li>
<li><p>将密码加密</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RegistrationForm</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">toUser</span><span class="params">(PasswordEncoder passwordEncoder)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">User</span>(username, passwordEncoder.encode(password), fullname, street, city, state, zip, phone);</span><br><span class="line">        <span class="comment">//密码在保存数据库前.通过PasswordEncoder中的encode将密码加密</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


</li>
<li><p>创建用户注册控制类</p>
</li>
<li><p>添加类级别**@Controller <strong>,</strong>@RequestMapping(“&#x2F;register”)**</p>
</li>
<li><p>注入<strong>UserRepository</strong>和<strong>PasswordEncoder</strong></p>
</li>
<li><p>设置注册视图以及在控制类中配置跳转到注册视图的方法.</p>
</li>
<li><p>当表单输入成功后，调用<strong>UserRepository</strong>来保存用户</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping</span></span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">processRegistration</span><span class="params">(RegistrationForm form)</span>&#123;</span><br><span class="line">      userRepository.save(form.toUser(passwordEncoder));</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;redirect:/login&quot;</span>;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="保护Web请求"><a href="#保护Web请求" class="headerlink" title="保护Web请求"></a>保护Web请求</h4><p>我们需要把主页,登录页和注册页开放给未认证的用户.</p>
<p>在Spring Security配置类实现**configure(HttpSecurity http)**方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableWebSecurity</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SecurityConfig</span> <span class="keyword">extends</span> <span class="title class_">WebSecurityConfigurerAdapter</span> &#123;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">     ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="HttpSecurity配置功能"><a href="#HttpSecurity配置功能" class="headerlink" title="HttpSecurity配置功能"></a>HttpSecurity配置功能</h6><ul>
<li><strong>在为某个请求提供服务之前，需要先预先满足特定的条件</strong></li>
<li><strong>配置自定义的登录页</strong></li>
<li><strong>支持用户退出</strong></li>
<li><strong>预防跨站请求伪造</strong></li>
</ul>
<h5 id="保护请求"><a href="#保护请求" class="headerlink" title="保护请求"></a>保护请求</h5><p>对不同的请求有不同的安全需求</p>
<h6 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h6><p>在configure(HttpSecurity http)中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    http</span><br><span class="line">            .authorizeRequests()</span><br><span class="line">            .antMatchers(<span class="string">&quot;请求指定URL路径&quot;</span>)  </span><br><span class="line">            .安全配置方法;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h6 id="配置有顺序"><a href="#配置有顺序" class="headerlink" title="配置有顺序"></a><strong>配置有顺序</strong></h6><p>声明在前面的安全规则比后面声明的规则有更高优先级.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    http</span><br><span class="line">            .authorizeRequests()</span><br><span class="line">            .antMatchers(<span class="string">&quot;/design&quot;</span>,<span class="string">&quot;/orders&quot;</span>)</span><br><span class="line">                .hasRole(<span class="string">&quot;USER&quot;</span>)</span><br><span class="line">        <span class="comment">//默认开头”ROLE_“,所有不填&quot;ROLE_USER&quot;</span></span><br><span class="line">                .antMatchers(<span class="string">&quot;/&quot;</span>,<span class="string">&quot;/**&quot;</span>)</span><br><span class="line">                .permitAll();        </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>案例说明</p>
<ul>
<li>具备”ROLE_USER”权限的用户才能访问”&#x2F;design”和”&#x2F;orders”</li>
<li>其他请求允许所有用户访问.</li>
</ul>
<h6 id="安全配置方法"><a href="#安全配置方法" class="headerlink" title="安全配置方法"></a>安全配置方法</h6><table>
<thead>
<tr>
<th>方法</th>
<th>能干什么</th>
</tr>
</thead>
<tbody><tr>
<td>access(String)</td>
<td>给SpEL表达式并且最后结果为true，就给访问</td>
</tr>
<tr>
<td>anonymous()</td>
<td>允许匿名访问</td>
</tr>
<tr>
<td>authenticated()</td>
<td>允许认证过的用户访问</td>
</tr>
<tr>
<td>denyAll()</td>
<td>无条件拒绝所有访问</td>
</tr>
<tr>
<td>not()</td>
<td>对其他访问方法的结果求反</td>
</tr>
<tr>
<td>permitAll()</td>
<td>无条件允许访问</td>
</tr>
<tr>
<td>hasRole(String)</td>
<td>如果用户具备给定角色，就允许访问</td>
</tr>
<tr>
<td>hasAnyRole(String …)</td>
<td>如果用户具备给定角色中的某一个，就允许访问</td>
</tr>
<tr>
<td>hasAuthority(String …)</td>
<td>如果用户给定权限，就允许访问</td>
</tr>
<tr>
<td>hasAnyAuthority(String …)</td>
<td>如果用户具有权限中·某一个，就允许访问</td>
</tr>
<tr>
<td>hasIpAddress(String …)</td>
<td>如果请求是给定IP，就允许访问</td>
</tr>
<tr>
<td>fullyAuthenticated()</td>
<td>如果用户是完整认证(不是Remember-me功能认证),就允许访问</td>
</tr>
<tr>
<td>rememberMe()</td>
<td>如果用户是通过Remember-me功能认证的，就允许访问</td>
</tr>
</tbody></table>
<h6 id="access-方法中的SpEL表达式"><a href="#access-方法中的SpEL表达式" class="headerlink" title="access()方法中的SpEL表达式"></a>access()方法中的SpEL表达式</h6><p>acccess()通过SpEL表达式来实现各种各样的安全性限制</p>
<p>使用方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    http</span><br><span class="line">            .authorizeRequests()</span><br><span class="line">            .antMatchers(<span class="string">&quot;/design&quot;</span>,<span class="string">&quot;/orders&quot;</span>)</span><br><span class="line">            .access(<span class="string">&quot;hasRole(&#x27;USER&#x27;)&quot;</span>+<span class="string">&quot;&amp;&amp;&quot;</span>+<span class="string">&quot;year==3&quot;</span>)          </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>功能说明</p>
<ul>
<li>对于请求路径”&#x2F;design”,”&#x2F;orders”来说,只用当具备”ROLE_USER”并且year等于3的用户才可以访问</li>
<li>总结:<strong>在access(SpEL表达式) SpEL表达式的结果是boolean值就行.</strong></li>
</ul>
<p>SpEL表达式</p>
<table>
<thead>
<tr>
<th>表达式</th>
<th>计算结果</th>
</tr>
</thead>
<tbody><tr>
<td>authentication</td>
<td>用户认证对象</td>
</tr>
<tr>
<td>denyAll</td>
<td>结果一直是false</td>
</tr>
<tr>
<td>permitAll</td>
<td>结果一直是true</td>
</tr>
<tr>
<td>hasRole(roles)</td>
<td>如果用户具备给定角色，结果为true</td>
</tr>
<tr>
<td>hasAnyRole(list of roles)</td>
<td>如果用户具备给定角色中的某一个，结果为true</td>
</tr>
<tr>
<td>hasIpAddress(IP Address)</td>
<td>如果请求是给定IP，结果为true</td>
</tr>
<tr>
<td>isAnonymous()</td>
<td>如果当前是匿名用户，结果为true</td>
</tr>
<tr>
<td>isAuthenticated()</td>
<td>如果当前是进行认证，结果为true</td>
</tr>
<tr>
<td>isFullyAuthenticated()</td>
<td>如果用户是完整认证(不是Remember-me功能认证),结果为true</td>
</tr>
<tr>
<td>isRememberMe()</td>
<td>如果用户是通过Remember-me功能认证的，结果为true</td>
</tr>
<tr>
<td>principal</td>
<td>用户的principal对象</td>
</tr>
</tbody></table>
<h5 id="创建自定义的登录页"><a href="#创建自定义的登录页" class="headerlink" title="创建自定义的登录页"></a>创建自定义的登录页</h5><h6 id="功能"><a href="#功能" class="headerlink" title="功能"></a>功能</h6><ul>
<li>配置自定义登陆页</li>
<li>可配置上传路径和输入域</li>
<li>配置登陆成功后指向的页面</li>
<li>可配置是否返回登陆之前正在访问的页面</li>
</ul>
<h6 id="使用方法-1"><a href="#使用方法-1" class="headerlink" title="使用方法"></a>使用方法</h6><ul>
<li><p>在Spring Security安全配置类中重写<strong>configure(HttpSecurity http)</strong></p>
</li>
<li><p>**and()**分开安全配置</p>
</li>
<li><p>**formLogin()**配置登陆自定义的的登陆表单</p>
</li>
<li><p>**loginPage(“登陆页面路径”)**提供自定义登陆页面的路径(当用户没有认证需要登陆的时候就重定向到这)</p>
<ul>
<li><p><strong>需要控制器处理上面请求</strong></p>
</li>
<li><p>在<strong>Webconfig类&#x2F;主启动类</strong>中的addViewControllers添加登陆页面的<strong>视图控制器</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addViewControllers</span><span class="params">(ViewControllerRegistry registry)</span> &#123;</span><br><span class="line">    registry.addViewController(<span class="string">&quot;/&quot;</span>).setViewName(<span class="string">&quot;home&quot;</span>);</span><br><span class="line">    registry.addViewController(<span class="string">&quot;登陆页面路径&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>**loginProcessingUrl(“&#x2F;新路径”)**配置登陆表达上传路径（默认&#x3D;”&#x2F;login”）</p>
</li>
<li><p>配置登陆表达输入域</p>
<ul>
<li><strong>usernameParameter(“表单中用户输入域的名称”)</strong>(默认&#x3D;“username)</li>
<li>**passwordParameter(“表单中用户密码输入域的名称”)**（默认&#x3D;”password”）</li>
</ul>
</li>
<li><p><strong>defaultSuccessUrl(“&#x2F;新路径”,boolean(默认&#x3D;false)）</strong>配置登陆成功后<strong>跳转页面</strong>和<strong>是否返回登陆之前浏览页面</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        http</span><br><span class="line">                .authorizeRequests()</span><br><span class="line">                .antMatchers(<span class="string">&quot;/design&quot;</span>,<span class="string">&quot;/orders&quot;</span>)</span><br><span class="line">                .access(<span class="string">&quot;hasRole(&#x27;USER&#x27;)&quot;</span>)</span><br><span class="line">                .antMatchers(<span class="string">&quot;/&quot;</span>,<span class="string">&quot;/**&quot;</span>)</span><br><span class="line">                .access(<span class="string">&quot;permitAll()&quot;</span>)</span><br><span class="line">                .and()</span><br><span class="line">                .formLogin()</span><br><span class="line">            <span class="comment">//配置登陆表单</span></span><br><span class="line">                .loginPage(<span class="string">&quot;/login&quot;</span>)</span><br><span class="line">            <span class="comment">//配置登陆表单的路径为 ”/login“===&gt;视图控制器====》&quot;loign&quot;视图</span></span><br><span class="line">                .loginProcessingUrl(<span class="string">&quot;/abc&quot;</span>)</span><br><span class="line">            <span class="comment">//登陆表单上传到路径&quot;/abc&quot;</span></span><br><span class="line">                .usernameParameter(<span class="string">&quot;user&quot;</span>)</span><br><span class="line">            <span class="comment">//表单中输入域名称为“user”作为用户账号</span></span><br><span class="line">                .passwordParameter(<span class="string">&quot;pwd&quot;</span>)</span><br><span class="line">              <span class="comment">//表单中输入域名称为“pwd”作为用户密码</span></span><br><span class="line">                .defaultSuccessUrl(<span class="string">&quot;/design&quot;</span>,<span class="literal">true</span>);</span><br><span class="line">             <span class="comment">//登陆成功后重定向到&quot;/design&quot;,开启登陆后重定向到未登陆之前浏览的页面</span></span><br><span class="line">               </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h5 id="退出登陆"><a href="#退出登陆" class="headerlink" title="退出登陆"></a>退出登陆</h5><h6 id="功能-1"><a href="#功能-1" class="headerlink" title="功能"></a>功能</h6><ul>
<li>退出用户登陆按钮</li>
<li>配置退出登陆后指定页面</li>
</ul>
<h6 id="使用方法-2"><a href="#使用方法-2" class="headerlink" title="使用方法"></a>使用方法</h6><ul>
<li><p>在Spring Security安全配置类中重写<strong>configure(HttpSecurity http)</strong></p>
</li>
<li><p>**and()**分开安全配置</p>
</li>
<li><p>**logout()**退出登陆</p>
</li>
<li><p>**logoutSuccessUrl(“新路径”)**退出成功后重定向页面</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">.and()</span><br><span class="line">.logout()</span><br><span class="line">.logoutSuccessUrl(<span class="string">&quot;/&quot;</span>)</span><br><span class="line">    <span class="comment">//退出登陆后 访问路径为&quot;/&quot;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h6 id="表单"><a href="#表单" class="headerlink" title="表单"></a>表单</h6><ul>
<li><p><strong>程序会拦截”&#x2F;logout”的请求</strong></p>
</li>
<li><p>当用户按下按钮时，用户的<strong>session会重置</strong></p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;form th:action=&quot;@&#123;/logout&#125;&quot; method=&quot;post&quot;&gt;</span><br><span class="line">    &lt;input type=&quot;submit&quot; value=&quot;Logout 退出登陆&quot;&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="防止跨站请求伪造CSRF"><a href="#防止跨站请求伪造CSRF" class="headerlink" title="防止跨站请求伪造CSRF"></a>防止跨站请求伪造CSRF</h4><h5 id="是什么-1"><a href="#是什么-1" class="headerlink" title="是什么"></a>是什么</h5><p>一种安全攻击.他会让用户在一个恶意的Web页面上填写信息，然后自动(秘密的)将表单以攻击受害者的身份提交到另一个应用上.</p>
<h6 id="案例-1"><a href="#案例-1" class="headerlink" title="案例"></a>案例</h6><p>C用户登陆到A银行网站，但是突然有个弹窗弹出来，C用户点了，那么这个弹窗有个恶意表单提交(通常是隐藏的)给A银行，然后以C用户的cookie和session来发送，最后C用户银行钱不见了.(C用户的cookie和session没有泄露)</p>
<h5 id="应对策略"><a href="#应对策略" class="headerlink" title="应对策略"></a>应对策略</h5><ul>
<li>在展示表单中生成一个在隐藏域的CSRF token</li>
<li>提交表单的时候，token将和其他的表单数据以前发送至服务端</li>
<li>请求被服务端拦截，并与最初生成的token对比</li>
<li>如果匹配，请求会被处理</li>
</ul>
<p>PS：Spring Security默认提供CSRF保护.</p>
<h5 id="表单设置"><a href="#表单设置" class="headerlink" title="表单设置"></a>表单设置</h5><p><strong>每个表单</strong>都必须有”_csrf”的字段，它会持有CSRF token</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;input type=<span class="string">&quot;hidden&quot;</span> name=<span class="string">&quot;_csrf&quot;</span> th:value=<span class="string">&quot;$&#123;_csrf.token&#125;&quot;</span>&gt;</span><br></pre></td></tr></table></figure>



<h5 id="禁用CSRF支持-最好别干"><a href="#禁用CSRF支持-最好别干" class="headerlink" title="禁用CSRF支持(最好别干)"></a>禁用CSRF支持(最好别干)</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.and()</span><br><span class="line">.csrf()</span><br><span class="line">.disable();</span><br></pre></td></tr></table></figure>



<h4 id="获取用户信息"><a href="#获取用户信息" class="headerlink" title="获取用户信息"></a>获取用户信息</h4><p>我们不仅要用户注册登陆访问，还要获得用户的信息</p>
<h5 id="使用-AuthenticationPrincipal注解来标注方法-best"><a href="#使用-AuthenticationPrincipal注解来标注方法-best" class="headerlink" title="使用@AuthenticationPrincipal注解来标注方法(best)"></a>使用@AuthenticationPrincipal注解来标注方法(best)</h5><h6 id="优点-2"><a href="#优点-2" class="headerlink" title="优点"></a>优点</h6><ul>
<li>不用类型转换</li>
<li>把安全代码限制在注解层面</li>
</ul>
<h6 id="缺点-2"><a href="#缺点-2" class="headerlink" title="缺点"></a>缺点</h6><ul>
<li>你要知道用户的对象类型User</li>
</ul>
<h6 id="使用方法-3"><a href="#使用方法-3" class="headerlink" title="使用方法"></a>使用方法</h6><ul>
<li>添加方法参数注解@AuthenticationPrincipal</li>
<li>直接获得User对象</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">processOrder</span><span class="params">(<span class="meta">@Valid</span> Order order, Errors errors, SessionStatus sessionStatus, <span class="meta">@AuthenticationPrincipal</span> User user)</span> &#123;</span><br><span class="line">        ...</span><br><span class="line">        order.setUser(user);</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<h5 id="注入Principal对象到控制器方法中"><a href="#注入Principal对象到控制器方法中" class="headerlink" title="注入Principal对象到控制器方法中"></a>注入Principal对象到控制器方法中</h5><h6 id="优点-3"><a href="#优点-3" class="headerlink" title="优点"></a>优点</h6><ul>
<li>参数可直接<strong>调用</strong>用户对象</li>
</ul>
<h6 id="缺点-3"><a href="#缺点-3" class="headerlink" title="缺点"></a>缺点</h6><ul>
<li>在非安全相关代码掺杂安全代码</li>
</ul>
<h6 id="使用方法-4"><a href="#使用方法-4" class="headerlink" title="使用方法"></a>使用方法</h6><ul>
<li>方法参数Principal</li>
<li>principal.getName()直接返回用户名</li>
<li>这个Principal参数其实包含User对象</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">processOrder</span><span class="params">(<span class="meta">@Valid</span> Order order, Errors errors, SessionStatus sessionStatus, Principal principal)</span> &#123;</span><br><span class="line">   ...</span><br><span class="line">    <span class="type">User</span> <span class="variable">byUsername</span> <span class="operator">=</span> userRepository.findByUsername(principal.getName());</span><br><span class="line">    <span class="comment">//通过名称 查询User对象</span></span><br><span class="line">    order.setUser(byUsername);</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="注入Authentication对象到控制器方法中"><a href="#注入Authentication对象到控制器方法中" class="headerlink" title="注入Authentication对象到控制器方法中"></a>注入Authentication对象到控制器方法中</h5><h6 id="优点-4"><a href="#优点-4" class="headerlink" title="优点"></a>优点</h6><ul>
<li>直接<strong>获得</strong>User对象</li>
</ul>
<h6 id="缺点-4"><a href="#缺点-4" class="headerlink" title="缺点"></a>缺点</h6><ul>
<li>需要转换类型</li>
</ul>
<h6 id="使用方法-5"><a href="#使用方法-5" class="headerlink" title="使用方法"></a>使用方法</h6><ul>
<li>参数方法Authentication</li>
<li>authentication.getPrincipal()获取其中User对象</li>
<li>将Obejct类型转User类型</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping</span></span><br><span class="line">   <span class="keyword">public</span> String <span class="title function_">processOrder</span><span class="params">(<span class="meta">@Valid</span> Order order, Errors errors, SessionStatus sessionStatus, Authentication authentication)</span> &#123;</span><br><span class="line">       ...</span><br><span class="line">       <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span>(User) authentication.getPrincipal();</span><br><span class="line">       order.setUser(user);</span><br><span class="line">       ...</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>



<h5 id="使用SecurityContextHolder来获取安全上下文"><a href="#使用SecurityContextHolder来获取安全上下文" class="headerlink" title="使用SecurityContextHolder来获取安全上下文"></a>使用SecurityContextHolder来获取安全上下文</h5><h6 id="优点-5"><a href="#优点-5" class="headerlink" title="优点"></a>优点</h6><ul>
<li>可以在应用测序的任何地方使用，不止控制器类</li>
</ul>
<h6 id="缺点-5"><a href="#缺点-5" class="headerlink" title="缺点"></a>缺点</h6><ul>
<li>安全性相关代码太多</li>
</ul>
<h6 id="使用方法-6"><a href="#使用方法-6" class="headerlink" title="使用方法"></a>使用方法</h6><ul>
<li>从Security上下文获得Authentication对象</li>
<li>从Authentication调用getPrincipal得到Principal对象</li>
<li>再转类型到User</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">processOrder</span><span class="params">(<span class="meta">@Valid</span> Order order, Errors errors, SessionStatus sessionStatus)</span> &#123;</span><br><span class="line">        ...</span><br><span class="line"> <span class="type">Authentication</span> <span class="variable">authentication1</span> <span class="operator">=</span> SecurityContextHolder.getContext().getAuthentication();</span><br><span class="line">                 <span class="type">User</span> <span class="variable">principal</span> <span class="operator">=</span> (User) authentication1.getPrincipal();</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<h3 id="使用配置属性"><a href="#使用配置属性" class="headerlink" title="使用配置属性"></a>使用配置属性</h3><p>springboot可以<strong>自动配置</strong>，也有<strong>配置属性</strong>的方法</p>
<h4 id="细粒度的自动配置"><a href="#细粒度的自动配置" class="headerlink" title="细粒度的自动配置"></a>细粒度的自动配置</h4><h5 id="一般配置方法"><a href="#一般配置方法" class="headerlink" title="一般配置方法"></a>一般配置方法</h5><ul>
<li><strong>bean装配</strong>:声明在Spring应用上下文中创建哪些应用组件以及它们之间如何互相注入的配置</li>
<li><strong>属性注入</strong>:设置Spring应用上下文中bean的值的配置.</li>
</ul>
<h5 id="显式声明"><a href="#显式声明" class="headerlink" title="显式声明"></a>显式声明</h5><ul>
<li><strong>XML方式</strong></li>
<li><strong>基于java的配置</strong></li>
</ul>
<h4 id="通过不同属性源配置Spring"><a href="#通过不同属性源配置Spring" class="headerlink" title="通过不同属性源配置Spring"></a>通过不同属性源配置Spring</h4><h5 id="属性源"><a href="#属性源" class="headerlink" title="属性源"></a>属性源</h5><p>以修改端口为例子</p>
<ul>
<li><p>JVM系统属性</p>
</li>
<li><p><strong>操作系统环境变量</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ export SERVER_PORT=9090</span><br><span class="line">操作系统的环境变量一次性设置</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>命令行参数</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ java -jar 包名.jar --server.port=9090</span><br><span class="line">命令行参数启动应用时候</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Application.properties</strong></p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#在src/main/resources/application.properties</span></span><br><span class="line"><span class="attr">server.port</span>=<span class="string">9090</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Application.yml</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#在src/main/resources/application.yml</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">9091</span></span><br></pre></td></tr></table></figure></li>
</ul>
<p>PS：SERVER_PORT和server.port一样</p>
<h4 id="配置数据源"><a href="#配置数据源" class="headerlink" title="配置数据源"></a>配置数据源</h4><p>开发环境:嵌入式H2</p>
<p>生产环境:Mysql</p>
<h5 id="配置数据源-1"><a href="#配置数据源-1" class="headerlink" title="配置数据源"></a>配置数据源</h5><p>在<strong>application.yml</strong>中</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/数据库名?useUnicode=true&amp;characterEncoding=UTF-8</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">用户</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">密码</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br></pre></td></tr></table></figure>

<p>如果类路径中存在Tomcat的JDBC连接池，DataSource将使用该连接池，否则会使用</p>
<ul>
<li><strong>HikariCP</strong></li>
<li><strong>Commons DBCP 2</strong></li>
</ul>
<h5 id="JNDI配置数据源"><a href="#JNDI配置数据源" class="headerlink" title="JNDI配置数据源"></a>JNDI配置数据源</h5><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">     <span class="attr">jndi-name:</span> <span class="string">路径</span></span><br><span class="line"><span class="comment">#配置这个，那么上面的就会失效</span></span><br></pre></td></tr></table></figure>



<h4 id="配置嵌入式服务器"><a href="#配置嵌入式服务器" class="headerlink" title="配置嵌入式服务器"></a>配置嵌入式服务器</h4><h5 id="开放可用任意端口"><a href="#开放可用任意端口" class="headerlink" title="开放可用任意端口"></a>开放可用任意端口</h5><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">server：</span></span><br><span class="line">  <span class="string">port：0</span></span><br></pre></td></tr></table></figure>



<h5 id="处理HTTPS请求"><a href="#处理HTTPS请求" class="headerlink" title="处理HTTPS请求"></a>处理HTTPS请求</h5><ol>
<li><p>用JDK的keytool命令行工具生成keystore</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ keytool -keystore mykeys.jks -genkey -alias tomcat -keyalg RSA</span><br></pre></td></tr></table></figure>
</li>
<li><p>在<strong>application.yml</strong>配置</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">server：</span></span><br><span class="line">  <span class="string">port;</span> <span class="string">开放端口</span></span><br><span class="line">  <span class="string">ssl：</span></span><br><span class="line">   <span class="attr">key-store:</span> <span class="string">file:文件路径</span> <span class="string">或者</span> <span class="string">&quot;classpath:JAR包路径&quot;</span></span><br><span class="line">   <span class="attr">key-store-passord:</span> <span class="string">密码</span></span><br><span class="line">   <span class="attr">key-password:</span> <span class="string">密码</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="配置日志"><a href="#配置日志" class="headerlink" title="配置日志"></a>配置日志</h4><p>目的：<strong>设置日志级别</strong></p>
<h5 id="使用方法-7"><a href="#使用方法-7" class="headerlink" title="使用方法"></a>使用方法</h5><ol>
<li><p>在<strong>application.yml</strong></p>
</li>
<li><p>以<strong>logging.level</strong>作为前缀的属性</p>
</li>
<li><p>&#96;&#96;&#96;yaml<br>logging:<br>   level:<br>包全名: 日志级别    </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">4. 生成日志地址</span><br><span class="line"></span><br><span class="line">   - ```yaml</span><br><span class="line">     logging:</span><br><span class="line">       file:</span><br><span class="line">         name: 具体路径包含日志命名</span><br></pre></td></tr></table></figure>

<ul>
<li>&#96;&#96;&#96;yaml<br>logging:<br>  file:<br>path: 具体路径<br>#默认生成一个spring.log日志文件<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">##### 例子</span><br><span class="line"></span><br><span class="line">```yaml</span><br><span class="line">logging:</span><br><span class="line">  level:</span><br><span class="line">    root: warn</span><br><span class="line">    org.springframework.security: debug</span><br><span class="line">  file:</span><br><span class="line">    name: C:\Users\13703\Desktop\spring.log</span><br><span class="line">   path: C:\Users\13703\Desktop</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ol>
<h5 id="限制"><a href="#限制" class="headerlink" title="限制"></a>限制</h5><p>默认情况下，日志文件超过10MB，就会轮换.</p>
<h4 id="使用其他配置属性的属性值"><a href="#使用其他配置属性的属性值" class="headerlink" title="使用其他配置属性的属性值"></a>使用其他配置属性的属性值</h4><p>从其他的配置属性注入到其他属性</p>
<h5 id="占位符"><a href="#占位符" class="headerlink" title="${}占位符"></a>${}占位符</h5><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">a:</span></span><br><span class="line"> <span class="attr">b:</span> <span class="string">you</span> <span class="string">$&#123;b.c&#125;</span></span><br></pre></td></tr></table></figure>

<h5 id="目的-1"><a href="#目的-1" class="headerlink" title="目的"></a>目的</h5><p>在配置Spring自己的组件中，使用配置属性可用容易地将值注入到这些组件属性中，并且可以细粒度地调整自己配置功能.</p>
<h4 id="创建自己的配置属性"><a href="#创建自己的配置属性" class="headerlink" title="创建自己的配置属性"></a>创建自己的配置属性</h4><ol>
<li><p>首先在需要配置属性的类中添加</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//@ConfigurationProperties(prefix = &quot;配置前缀&quot;)</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;b.c&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">a</span>&#123;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>设置类里面的值为属性(设置b.c中的a值)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;b.c&quot;)</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">a</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String a;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setA</span><span class="params">(String a)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.a=a;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在<strong>application.yml</strong>配置属性</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">b:</span></span><br><span class="line"> <span class="attr">c:</span></span><br><span class="line">  <span class="attr">a:</span> <span class="string">&quot;我是a值&quot;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>或者设置环境变量</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ export B_C_A=&quot;我是A值&quot;</span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="定义配置属性的持有者"><a href="#定义配置属性的持有者" class="headerlink" title="定义配置属性的持有者"></a>定义配置属性的持有者</h4><h5 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h5><ul>
<li><strong>@ConfigurationProperties</strong>只能用在控制器或特定类型的bean</li>
<li><strong>@ConfigurationProperties</strong>通常设置一种bean<strong>专门持有配置数据</strong></li>
<li>通过配置属性持有者bean，我们把所有的配置属性收集到一个地方，这样可以使其他bean因可能保持整洁.</li>
</ul>
<h5 id="例子："><a href="#例子：" class="headerlink" title="例子："></a>例子：</h5><p>以上为例</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;b.c&quot;)</span></span><br><span class="line"><span class="keyword">public</span> clsss d&#123;</span><br><span class="line">    <span class="keyword">private</span> String a=<span class="string">&quot;sb&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="声明配置属性元数据"><a href="#声明配置属性元数据" class="headerlink" title="声明配置属性元数据"></a>声明配置属性元数据</h4><p>说白了，给<strong>配置属性提供一个最小化的文档</strong>.</p>
<h5 id="使用方法-8"><a href="#使用方法-8" class="headerlink" title="使用方法"></a>使用方法</h5><ol>
<li><p>在**”src&#x2F;main&#x2F;resources&#x2F;META-INF”<strong>下面创建</strong>additional-spring-configuration-metadata.json**</p>
</li>
<li><p>&#96;&#96;&#96;json<br>{<br>  “properties”: [<br>{<br>    &#x2F;&#x2F;配置属性的全名<br>“name”: “taco.config.page-size”,<br>    &#x2F;&#x2F;配置属性的参数类全名<br>“type”: “java.lang.String”,<br>    &#x2F;&#x2F;这个配置属性的简短描述<br>“description”: “我是傻逼.”<br>  }<br>  ]<br>}</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">##### 例子</span><br><span class="line"></span><br><span class="line">![](D:\TyporaOfimage\屏幕截图 2021-08-25 032226-1629833010580.jpg)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#### 使用profile进行配置</span><br><span class="line"></span><br><span class="line">##### 目的</span><br><span class="line"></span><br><span class="line">- **为不同的部署环境配置不同的属性**</span><br><span class="line">- 解决配置属性太多，设置麻烦，并且支持回滚</span><br><span class="line"></span><br><span class="line">##### 是什么</span><br><span class="line"></span><br><span class="line">profile是一种条件化的配置，在运行时，根据哪些profile处于激活状态，可以使用或忽略不同的bean，配置类和配置属性.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#### 定义特定profile的属性</span><br><span class="line"></span><br><span class="line">##### 全局设置</span><br><span class="line"></span><br><span class="line">- 创建**application.yml**</span><br><span class="line">- **全局的属性配置**</span><br><span class="line"></span><br><span class="line">##### 分开文件设置</span><br><span class="line"></span><br><span class="line">- 创建**application-&#123;profile名&#125;.yml**</span><br><span class="line">- 一个文件一个环境</span><br><span class="line">  - application-dev.yml  代表dev环境</span><br><span class="line">  - application-prod.yml  代表prod环境</span><br><span class="line">  - application-test.yml   代表test环境</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#### 激活profile</span><br><span class="line"></span><br><span class="line">##### 默认激活</span><br><span class="line"></span><br><span class="line">- 在**application.yml**</span><br><span class="line"></span><br><span class="line">- ```yaml</span><br><span class="line">  spring:</span><br><span class="line">     profiles:</span><br><span class="line">      active: 环境名(例如&quot;dev&quot;)</span><br><span class="line">      #代表默认激活dev这个环境的配置属性</span><br></pre></td></tr></table></figure></li>
</ol>
<h5 id="激活"><a href="#激活" class="headerlink" title="激活"></a>激活</h5><ul>
<li><p><strong>生产环境</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">% export SPRING_PROFILES_ACTIVE=dev</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>命令行参数启动</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">% java -jar 包名.jar --spring.profiles.active=dev</span><br></pre></td></tr></table></figure></li>
</ul>
<h5 id="批量激活"><a href="#批量激活" class="headerlink" title="批量激活"></a>批量激活</h5><ul>
<li><p><strong>生产环境</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">% java -jar 包名.jar --spring.profiles.active=prod,dev,test</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>默认yaml</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">   profiles:</span><br><span class="line">    active: </span><br><span class="line">    - prod</span><br><span class="line">    - dev</span><br><span class="line">    - test</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="使用profile条件化创建bean"><a href="#使用profile条件化创建bean" class="headerlink" title="使用profile条件化创建bean"></a>使用profile条件化创建bean</h4><p>为不同的profile创建一组bean</p>
<ul>
<li>正常来说，java配置类中声明的bean都会被创建</li>
<li>使用**@Profile<strong>注解</strong>将某些bean设置成特定的prfile才能被创建**</li>
</ul>
<h5 id="Bean方法级别"><a href="#Bean方法级别" class="headerlink" title="@Bean方法级别"></a>@Bean方法级别</h5><ul>
<li>@Profile(“环境名”)</li>
<li>@Profile({“环境名1”,”环境名2,”…..})</li>
<li><strong>!符号代表不激活</strong><ul>
<li>@Profile({“！环境名1”,”！环境名2,”…..})</li>
<li><strong>当环境1和环境2不激活的时候，这个bean才被创建</strong></li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@Profile(&quot;环境名&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">a</span><span class="params">()</span>&#123;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="Configuration类级别"><a href="#Configuration类级别" class="headerlink" title="@Configuration类级别"></a>@Configuration类级别</h5><p>与上同理</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@Profile(&quot;环境名&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">b</span>&#123;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="Spring集成"><a href="#Spring集成" class="headerlink" title="Spring集成"></a>Spring集成</h2><h3 id="创建Rest服务"><a href="#创建Rest服务" class="headerlink" title="创建Rest服务"></a>创建Rest服务</h3><h4 id="两种程序设计模式"><a href="#两种程序设计模式" class="headerlink" title="两种程序设计模式"></a>两种程序设计模式</h4><ul>
<li><strong>MPA</strong>(MultiPage Application)：传统的多页应用<ul>
<li>只需要在Web页面显示信息</li>
</ul>
</li>
<li><strong>SPA</strong>(Single-Page Applcaiton)：基于前端框架的单页应用<ul>
<li>前后端分离</li>
<li>利于开发相同后端，不同前端的应用.</li>
</ul>
</li>
<li>并不一定都用SPA，简单显示页面就选择MPA</li>
</ul>
<h4 id="创建RESTful控制器类"><a href="#创建RESTful控制器类" class="headerlink" title="创建RESTful控制器类"></a>创建RESTful控制器类</h4><ol>
<li><strong>类级别@RestController</strong></li>
<li><strong>类级别@Controller和每个方法@ResponseBody</strong></li>
<li><strong>返回ResponseEntity对象</strong></li>
</ol>
<h4 id="RESTful控制器类中的HTTP请求处理"><a href="#RESTful控制器类中的HTTP请求处理" class="headerlink" title="RESTful控制器类中的HTTP请求处理"></a>RESTful控制器类中的HTTP请求处理</h4><h5 id="请求处理注解"><a href="#请求处理注解" class="headerlink" title="请求处理注解"></a>请求处理注解</h5><table>
<thead>
<tr>
<th>注解</th>
<th>HTTP 方法</th>
<th>用途</th>
</tr>
</thead>
<tbody><tr>
<td>@GetMapping</td>
<td>HTTP GET请求</td>
<td>读取资源数据</td>
</tr>
<tr>
<td>@PostMapping</td>
<td>HTTP POST请求</td>
<td>创建资源</td>
</tr>
<tr>
<td>@PutMapping</td>
<td>HTTP Put请求</td>
<td>更新全部资源</td>
</tr>
<tr>
<td>@PatchMapping</td>
<td>HTTP Patch请求</td>
<td>更新部分资源</td>
</tr>
<tr>
<td>@DeleteMapping</td>
<td>HTTP Delete请求</td>
<td>删除资源</td>
</tr>
<tr>
<td>@RequestMapping</td>
<td>全部HTTP请求方法都行</td>
<td>一般在类级别作这个控制器类设置和设置基础地址</td>
</tr>
</tbody></table>
<h5 id="注解中的参数"><a href="#注解中的参数" class="headerlink" title="注解中的参数"></a>注解中的参数</h5><ul>
<li><strong>path</strong>：请求路径</li>
<li><strong>consumes</strong>：指定请求<strong>输入</strong>类型</li>
<li><strong>produces</strong>：指定请求<strong>返回</strong>类型</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(path = &quot;/box&quot;,produces = &#123;&quot;application/json&quot;,&quot;text/xml&quot;&#125;)</span></span><br><span class="line"><span class="comment">//这个控制类基础请求时/box  并且这个类下面全部方法的指定返回类型是JSON或者XML</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BoxController</span> &#123;</span><br><span class="line">   ...</span><br><span class="line">    <span class="meta">@PostMapping(consumes = &quot;application/json&quot;)</span></span><br><span class="line">       <span class="comment">//这个方法的请求类型是JSON</span></span><br><span class="line">    <span class="keyword">public</span> Box <span class="title function_">saveBox</span><span class="params">(<span class="meta">@RequestBody</span> Box box)</span>&#123;</span><br><span class="line">       ...</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h5 id="请求成功后返回Stats-状态码"><a href="#请求成功后返回Stats-状态码" class="headerlink" title="请求成功后返回Stats(状态码)"></a>请求成功后返回Stats(状态码)</h5><ul>
<li><p>方法级别**@ResponseStatus(HTTPStatus.状态码类型)**</p>
</li>
<li><p><strong>返回ResponseEntity对象</strong></p>
<ul>
<li>&#96;&#96;&#96;java<br>return new ResponseEntity&lt;&gt;(返回对象&#x2F;NUll,HTTPStatus.状态码类型);<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">例子：</span><br><span class="line"></span><br><span class="line">```java</span><br><span class="line">@RestController</span><br><span class="line">@RequestMapping(path = &quot;/box&quot;,produces = &quot;application/json&quot;)</span><br><span class="line">public class BoxController &#123;</span><br><span class="line">   ...</span><br><span class="line">     @DeleteMapping(&quot;/&#123;id&#125;&quot;)</span><br><span class="line">    @ResponseStatus(code=HttpStatus.NO_CONTENT)</span><br><span class="line">       //当请求到/box/&#123;id&#125; 服务器就会返回状态码NO_CONTENT(204)</span><br><span class="line">    public ResponseEntity deleteBox(@PathVariable Long id)&#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            boxRepository.deleteById(id);</span><br><span class="line">            return new ResponseEntity(HttpStatus.OK);</span><br><span class="line">            // 当删除数据成功 就返回ResponseEntity对象，并指定状态码OK(200)</span><br><span class="line">        &#125; catch (EmptyResultDataAccessException e) &#123;</span><br><span class="line">            return new ResponseEntity&lt;&gt;(null,HttpStatus.NOT_FOUND);</span><br><span class="line">            // 当抛出没有找到的异常时 就返回ResponseEntity对象，并指定响应体=null，返回状态码404</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h5 id="允许跨域请求"><a href="#允许跨域请求" class="headerlink" title="允许跨域请求"></a>允许跨域请求</h5><ul>
<li>类级别**@CrossOrigin(origins &#x3D; “<em>“)</em>*</li>
</ul>
<h4 id="RESTful控制器类中的HTTP参数处理"><a href="#RESTful控制器类中的HTTP参数处理" class="headerlink" title="RESTful控制器类中的HTTP参数处理"></a>RESTful控制器类中的HTTP参数处理</h4><h5 id="PathVariable"><a href="#PathVariable" class="headerlink" title="@PathVariable"></a><strong>@PathVariable</strong></h5><ul>
<li><p>通过处理器方法的<strong>路径上使用占位符</strong>并让<strong>方法接收一个路径变量</strong></p>
</li>
<li><p>&#96;&#96;&#96;java<br>@GetMapping(“&#x2F;{id}”)<br>public ResponseEntity<Box> getBoxByid(@PathVariable long id){<br>…<br>}</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">##### **@RequestBody**</span><br><span class="line"></span><br><span class="line">- 从请求体中**请求参数(例如JSON)**会被绑定到指定对象中</span><br><span class="line"></span><br><span class="line">- 如果没有这个注解，程序会将**请求参数(查询参数/表单参数)**绑定到指定对象中</span><br><span class="line"></span><br><span class="line">- ```java</span><br><span class="line">  @PutMapping(&quot;/&#123;id&#125;&quot;)</span><br><span class="line">  public Box putBox(@RequestBody Box box)&#123;</span><br><span class="line">      ...</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="启用超媒体"><a href="#启用超媒体" class="headerlink" title="启用超媒体"></a>启用超媒体</h4><h5 id="超媒体作为应用状态引擎-Hypermedia-as-the-Engine-of-Aplication-State-HATEOAS"><a href="#超媒体作为应用状态引擎-Hypermedia-as-the-Engine-of-Aplication-State-HATEOAS" class="headerlink" title="超媒体作为应用状态引擎( Hypermedia as the Engine of Aplication State , HATEOAS )"></a>超媒体作为应用状态引擎( Hypermedia as the Engine of Aplication State , HATEOAS )</h5><p>是一种创建自描述 API 的方式.</p>
<ul>
<li>API返回<strong>包含资源链接和资源</strong>的内容</li>
<li>客户端通过最少API URL可以<strong>导航全部API</strong></li>
<li>通过API描述自己的URL，减少客户端硬编码的痛苦.</li>
</ul>
<h5 id="超文本应用语言-Hypertext-Application-Language-HAL"><a href="#超文本应用语言-Hypertext-Application-Language-HAL" class="headerlink" title="超文本应用语言(Hypertext Application Language,HAL)"></a>超文本应用语言(Hypertext Application Language,HAL)</h5><p>一种在JSON响应中<strong>嵌入超链接</strong>的简单通用格式.</p>
<ul>
<li><strong>_links</strong>：为客户端提供导航API</li>
<li><strong>recents</strong>：引用该API本身</li>
</ul>
<h5 id="特点-1"><a href="#特点-1" class="headerlink" title="特点"></a>特点</h5><h6 id="优点-6"><a href="#优点-6" class="headerlink" title="优点"></a>优点</h6><ul>
<li>向API添加链接变简单</li>
</ul>
<h6 id="缺点-6"><a href="#缺点-6" class="headerlink" title="缺点"></a>缺点</h6><ul>
<li>产生额外代码</li>
<li>如果API的URL模式发生变化，客户端代码就不可用了</li>
</ul>
<h5 id="引入依赖-1"><a href="#引入依赖-1" class="headerlink" title="引入依赖"></a>引入依赖</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-hateoas&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>



<h4 id="添加超链接"><a href="#添加超链接" class="headerlink" title="添加超链接"></a>添加超链接</h4><h5 id="超链接资源"><a href="#超链接资源" class="headerlink" title="超链接资源"></a>超链接资源</h5><p>当Spring MVC REST控制器<strong>返回时</strong>，<strong>携带的链接和资源将会包含到JSON</strong>中.</p>
<ul>
<li><strong>EntityModel</strong>：一个资源</li>
<li><strong>CollectionModel</strong>：资源的集合</li>
</ul>
<h5 id="为资源添加超链接"><a href="#为资源添加超链接" class="headerlink" title="为资源添加超链接"></a>为资源添加超链接</h5><ol>
<li><p>CollectionModel.wrap(输出对象集合)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CollectionModel&lt;EntityModel&lt;输出对象&gt;&gt; entityModels = CollectionModel.wrap(输出对象集合);</span><br></pre></td></tr></table></figure>
</li>
<li><p>获得CollectionModel&lt;EntityModel&lt;输出对象&gt;&gt;对象</p>
</li>
<li><p>在返回资源之前，给CollectionModel&lt;EntityModel&lt;输出对象&gt;&gt;对象通过.add方法添加（名为recent，URL为这个方法访问具体URL）的关联关系</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">CollectionModel&lt;EntityModel&lt;输出对象&gt;&gt;对象.add(</span><br><span class="line">...</span><br><span class="line"><span class="comment">//链接构建者,就是下面的</span></span><br><span class="line">        );</span><br></pre></td></tr></table></figure>

<ul>
<li><p>这是给最顶层添加超链接</p>
</li>
<li><p><strong>自动探知主机名，避免直接进行硬编码</strong>的方法</p>
</li>
<li><p>&#96;&#96;&#96;java<br>WebMvcLinkBuilder.linkTo(本类.class)<br>.slash(“地址1”)<br>.withRel(“关联关系名”)<br>&#x2F;&#x2F;URL：本类URL+&#x2F;+地址1  要等于 本类本方法的一起的URL<br>&#x2F;&#x2F;地址1 就是从类中方法URL<br>&#x2F;&#x2F;.slash(“地址”) 是自动给地址前加斜杠</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- ```java</span><br><span class="line">  WebMvcLinkBuilder</span><br><span class="line">      .linkTo(WebMvcLinkBuilder.methodOn(本类.class).本类中方法())</span><br><span class="line">      .withRel(&quot;关联关系名&quot;)</span><br><span class="line">   //URL: 本类URL + 类中方法URL</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>返回CollectionModel&lt;EntityModel&lt;输出对象&gt;&gt;对象</p>
</li>
</ol>
<h5 id="案例-2"><a href="#案例-2" class="headerlink" title="案例"></a>案例</h5><h6 id="部分代码"><a href="#部分代码" class="headerlink" title="部分代码"></a>部分代码</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(path = &quot;/design&quot;,produces = &quot;application/json&quot;)</span></span><br><span class="line"><span class="meta">@CrossOrigin(origins = &quot;*&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DesignTacoController</span> &#123;</span><br><span class="line">    ...     </span><br><span class="line">       <span class="meta">@GetMapping(&quot;/recent&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> CollectionModel&lt;EntityModel&lt;Taco&gt;&gt; <span class="title function_">recentTaco</span><span class="params">()</span>&#123;</span><br><span class="line">        </span><br><span class="line">        <span class="type">PageRequest</span> <span class="variable">page</span> <span class="operator">=</span> PageRequest.of(<span class="number">0</span>, <span class="number">12</span>, Sort.by(<span class="string">&quot;createdat&quot;</span>).descending());</span><br><span class="line">        </span><br><span class="line">        List&lt;Taco&gt; content = tacoRepository.findAll(page).getContent();</span><br><span class="line">        </span><br><span class="line">        CollectionModel&lt;EntityModel&lt;Taco&gt;&gt; entityModels = CollectionModel.wrap(content);</span><br><span class="line">        </span><br><span class="line">        entityModels.add(</span><br><span class="line">                WebMvcLinkBuilder.linkTo(DesignTacoController.class)</span><br><span class="line">                .slash(<span class="string">&quot;recent&quot;</span>)</span><br><span class="line">                .withRel(<span class="string">&quot;abc123&quot;</span>)</span><br><span class="line">        );</span><br><span class="line">        <span class="keyword">return</span> entityModels;</span><br><span class="line">    &#125; </span><br><span class="line">        ...</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h6 id="输入URL"><a href="#输入URL" class="headerlink" title="输入URL"></a>输入URL</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost:8080/design/recent</span><br></pre></td></tr></table></figure>

<h6 id="部分JSON结果"><a href="#部分JSON结果" class="headerlink" title="部分JSON结果"></a>部分JSON结果</h6><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;_links&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;abc123&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;href&quot;</span><span class="punctuation">:</span> <span class="string">&quot;http://localhost:8080/design/recent&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>





<h4 id="创建资源装配器"><a href="#创建资源装配器" class="headerlink" title="创建资源装配器"></a>创建资源装配器</h4><h5 id="目的-2"><a href="#目的-2" class="headerlink" title="目的"></a>目的</h5><p>把对象类变成<strong>带链接和对象</strong>的<strong>资源</strong>类，并通过一个<strong>工具类</strong>批量转换.</p>
<p>对象集合—&gt;工具类—–&gt;资源类集合</p>
<h5 id="资源类"><a href="#资源类" class="headerlink" title="资源类"></a><strong>资源</strong>类</h5><ul>
<li>创建资源类</li>
<li>继承<strong>RepresentationModel</strong>&lt;本资源类&gt;</li>
<li>提供要输出的属性，并添加**@Getter**注解</li>
<li>创建参数是原本对象的有参构造方法</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IngredientEntityModel</span> <span class="keyword">extends</span> <span class="title class_">RepresentationModel</span>&lt;IngredientEntityModel&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Getter</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Getter</span></span><br><span class="line">    <span class="keyword">private</span> Ingredient.Type type;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">IngredientEntityModel</span><span class="params">(Ingredient ingredient)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = ingredient.getName();</span><br><span class="line">        <span class="built_in">this</span>.type = ingredient.getType();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="工具类（资源装配器）"><a href="#工具类（资源装配器）" class="headerlink" title="工具类（资源装配器）"></a>工具类（资源装配器）</h5><ul>
<li><p>创建工具类</p>
</li>
<li><p>继承<strong>RepresentationModelAssemblerSupport</strong>&lt;**对象**, **对象对应的资源类**&gt;</p>
</li>
<li><p>重写超类<strong>IngredientEntityModelAssembler</strong></p>
<ul>
<li><p>在创建<strong>对象对应资源类</strong>中的<strong>链接</strong>时，从<strong>控制类</strong>中获得<strong>所有URL的基础路径</strong></p>
</li>
<li><p>&#96;&#96;&#96;java<br>public IngredientEntityModelAssembler(Class&lt;?&gt; controllerClass, Class<IngredientEntityModel> resourceType) {<br>super(控制类.class, 对象对应资源类.class);<br>}</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 重写**instantiateModel**方法</span><br><span class="line"></span><br><span class="line">  - 用**对象类**来**实例化对象对应资源类**</span><br><span class="line"></span><br><span class="line">  - ```java</span><br><span class="line">    @Override</span><br><span class="line">    protected 对象对应资源类 instantiateModel(对象类 entity) &#123;</span><br><span class="line">        return new 对象对应资源类(entity);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>重写<strong>toModel</strong>方法(必须实现)</p>
<ul>
<li><p>通过<strong>对象类</strong>创建<strong>对象对应资源类</strong></p>
</li>
<li><p>设置一个<strong>self链接</strong>（<strong>由对象的id属性(主键)自动衍生出来</strong>）</p>
</li>
<li><p>&#96;&#96;&#96;java<br>@Override<br>public 对象对应资源类 toModel(对象类 entity) {<br>return createModelWithId(entity.getId(), entity);<br>}</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">##### 具体使用</span><br><span class="line"></span><br><span class="line">- 返回值不再是CollectionModel&lt;EntityModel&lt;对象类&gt;&gt;，而是**CollectionModel&lt;对象对应资源类&gt;**</span><br><span class="line">- 创建**工具类**对象</span><br><span class="line">- 并调用**toModel**方法(单个对象)或者**toCollectionModel**方法(对象集合)</span><br><span class="line">- 调用工具类对象.add()来添加最顶层超链接</span><br><span class="line">- 返回工具类对象</span><br><span class="line"></span><br><span class="line">```java</span><br><span class="line">@GetMapping(&quot;/recent&quot;)</span><br><span class="line">public CollectionModel&lt;TacoEntityModel&gt; recentTaco()&#123;</span><br><span class="line">    </span><br><span class="line">    PageRequest page = PageRequest.of(0, 12, Sort.by(&quot;createdat&quot;).descending());</span><br><span class="line">    </span><br><span class="line">    List&lt;Taco&gt; content = tacoRepository.findAll(page).getContent();</span><br><span class="line"></span><br><span class="line">    CollectionModel&lt;TacoEntityModel&gt; tacoEntityModels = new TacoEntityModelAssembler().toCollectionModel(content);</span><br><span class="line"></span><br><span class="line">    tacoEntityModels.add(</span><br><span class="line">        </span><br><span class="line"> WebMvcLinkBuilder.linkTo(WebMvcLinkBuilder.methodOn(DesignTacoController.class).recentTaco()).withRel(&quot;abc123&quot;)</span><br><span class="line">    </span><br><span class="line">    );</span><br><span class="line">    </span><br><span class="line">    return tacoEntityModels;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h5 id="嵌套使用"><a href="#嵌套使用" class="headerlink" title="嵌套使用"></a>嵌套使用</h5><p>当一个<strong>资源类中有其他对象类集合</strong>时，可以通过对应其他对象相关工具类，来添加链接，也就是从<strong>对象类转化为对应资源类</strong></p>
<ul>
<li><p>引入<strong>对应工具类</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">IngredientEntityModelAssembler</span> <span class="variable">ingredientEntityModelAssembler</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">IngredientEntityModelAssembler</span>();</span><br></pre></td></tr></table></figure>
</li>
<li><p>在<strong>有参构造方法使用</strong>工具类中的<strong>toModel</strong>方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ingredientEntityModelAssembler.toCollectionModel(taco.getIngredients());</span><br></pre></td></tr></table></figure></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TacoEntityModel</span> <span class="keyword">extends</span> <span class="title class_">RepresentationModel</span>&lt;TacoEntityModel&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">IngredientEntityModelAssembler</span> <span class="variable">ingredientEntityModelAssembler</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">IngredientEntityModelAssembler</span>();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Getter</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Getter</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Date createdAt;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Getter</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> CollectionModel&lt;IngredientEntityModel&gt; ingredients;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">TacoEntityModel</span><span class="params">(Taco taco)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = taco.getName();</span><br><span class="line">        <span class="built_in">this</span>.createdAt = taco.getCreatedat();</span><br><span class="line">        <span class="built_in">this</span>.ingredients =  ingredientEntityModelAssembler.toCollectionModel(taco.getIngredients());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="命名嵌套式的关联关系"><a href="#命名嵌套式的关联关系" class="headerlink" title="命名嵌套式的关联关系"></a>命名嵌套式的关联关系</h4><h5 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h5><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;_embedded&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;tacoEntityModleList&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      ...</span><br><span class="line">  <span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>要修改_embedded下面的名字</p>
<h5 id="Relation"><a href="#Relation" class="headerlink" title="@Relation"></a>@Relation</h5><p>消除JSON字段名和java代码中定义的资源类名之间的耦合.</p>
<ul>
<li>找到对应资源类</li>
<li>添加类级别的@Relation<ul>
<li><strong>value</strong>：单个资源类的命名</li>
<li><strong>collectionRelation</strong>：资源类集合的命名</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Relation(value = &quot;taco&quot;,collectionRelation = &quot;tacos&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TacoEntityModel</span> <span class="keyword">extends</span> <span class="title class_">RepresentationModel</span>&lt;TacoEntityModel&gt; &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//Taco资源类集合 命名=“tacos”</span></span><br><span class="line"><span class="comment">//单个Taco资源类 命名=&quot;taco&quot;</span></span><br></pre></td></tr></table></figure>



<h5 id="结果"><a href="#结果" class="headerlink" title="结果"></a>结果</h5><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;_embedded&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;tacos&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      ...</span><br><span class="line">  <span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<h4 id="启用数据后端服务"><a href="#启用数据后端服务" class="headerlink" title="启用数据后端服务"></a>启用数据后端服务</h4><h5 id="原理-1"><a href="#原理-1" class="headerlink" title="原理"></a>原理</h5><p>使用Spring Data Rest，基于我们<strong>定义的接口自动创建REST API.</strong></p>
<h5 id="引入依赖-2"><a href="#引入依赖-2" class="headerlink" title="引入依赖"></a>引入依赖</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-data-rest&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>



<h5 id="设置Spring-Data-REST端点的基础路径"><a href="#设置Spring-Data-REST端点的基础路径" class="headerlink" title="设置Spring Data REST端点的基础路径"></a>设置Spring Data REST端点的基础路径</h5><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">data:</span></span><br><span class="line">    <span class="attr">rest:</span></span><br><span class="line">      <span class="attr">base-path:</span> <span class="string">/路径</span></span><br></pre></td></tr></table></figure>



<h5 id="查看主资源-所有端点"><a href="#查看主资源-所有端点" class="headerlink" title="查看主资源(所有端点)"></a>查看主资源(所有端点)</h5><ul>
<li><p>先设置基础路径</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  data:</span><br><span class="line">    rest:</span><br><span class="line">      base-path: /api</span><br></pre></td></tr></table></figure>
</li>
<li><p>然后访问</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost:8080/api</span><br></pre></td></tr></table></figure></li>
</ul>
<h5 id="修改端点关系名和路径"><a href="#修改端点关系名和路径" class="headerlink" title="修改端点关系名和路径"></a>修改端点关系名和路径</h5><p>当为Spring Data repository创建端点的时候，Spring Data REST会尝试使用相关<strong>实体类的复数形式</strong>.</p>
<h6 id="给实体类添加-RestResource"><a href="#给实体类添加-RestResource" class="headerlink" title="给实体类添加@RestResource"></a>给实体类添加@RestResource</h6><ul>
<li><strong>rel</strong>：关系名</li>
<li><strong>path</strong>：路径</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@RestResource(rel = &quot;tacos&quot;,path = &quot;tacos&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Taco</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="部分功能"><a href="#部分功能" class="headerlink" title="部分功能"></a>部分功能</h5><p>支持</p>
<ul>
<li>GET请求</li>
<li>POST</li>
<li>PUT</li>
<li>PATCH</li>
</ul>
<p>案例（以ingredients实体类为例）</p>
<ul>
<li>“<a target="_blank" rel="noopener" href="http://localhost:8080/api/ingredients&quot;">http://localhost:8080/api/ingredients&quot;</a> GET:查看所有ingredients</li>
<li>“<a target="_blank" rel="noopener" href="http://localhost:8080/api/ingredients/id&quot;">http://localhost:8080/api/ingredients/id&quot;</a> GET:查看id的ingredients</li>
<li>“<a target="_blank" rel="noopener" href="http://localhost:8080/api/ingredients&quot;">http://localhost:8080/api/ingredients&quot;</a> POST:发送JSON内容创建ingredients</li>
<li>“<a target="_blank" rel="noopener" href="http://localhost:8080/api/ingredients/id&quot;">http://localhost:8080/api/ingredients/id&quot;</a> DELETE:删除对应id的内容</li>
<li>等等</li>
</ul>
<h5 id="分页和排序"><a href="#分页和排序" class="headerlink" title="分页和排序"></a>分页和排序</h5><ul>
<li><strong>page</strong>：具体的页数<ul>
<li>从0开始时第一页</li>
</ul>
</li>
<li><strong>size</strong>：每页的数量</li>
<li><strong>sort</strong>：根据实体的某个属性对结果进行排序</li>
</ul>
<h6 id="特殊功能"><a href="#特殊功能" class="headerlink" title="特殊功能"></a>特殊功能</h6><p>当指定page和size时，HATEOAS为我们提供第一页，下一页，上一页和最后一页的链接.</p>
<h6 id="案例-3"><a href="#案例-3" class="headerlink" title="案例"></a>案例</h6><p>链接</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost:8080/api/tacos?sort=createdAt,desc&amp;size=3&amp;page=1</span><br></pre></td></tr></table></figure>

<p>结果</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 20210829000859</span></span><br><span class="line"><span class="comment">// http://localhost:8080/api/tacos?sort=createdAt,desc&amp;size=3&amp;page=1</span></span><br><span class="line"></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;_embedded&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;tacos&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">     ...</span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_links&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;first&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;href&quot;</span><span class="punctuation">:</span> <span class="string">&quot;http://localhost:8080/api/tacos?page=0&amp;size=3&quot;</span></span><br><span class="line">      <span class="comment">//  第一页</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;prev&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;href&quot;</span><span class="punctuation">:</span> <span class="string">&quot;http://localhost:8080/api/tacos?page=0&amp;size=3&quot;</span></span><br><span class="line">      <span class="comment">//  上一页</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;self&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;href&quot;</span><span class="punctuation">:</span> <span class="string">&quot;http://localhost:8080/api/tacos?sort=createdAt,desc&amp;size=3&amp;page=1&quot;</span></span><br><span class="line">       <span class="comment">// 这一页</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;next&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;href&quot;</span><span class="punctuation">:</span> <span class="string">&quot;http://localhost:8080/api/tacos?page=2&amp;size=3&quot;</span></span><br><span class="line">       <span class="comment">// 下一页</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;last&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;href&quot;</span><span class="punctuation">:</span> <span class="string">&quot;http://localhost:8080/api/tacos?page=2&amp;size=3&quot;</span></span><br><span class="line">       <span class="comment">// 最后一页</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;profile&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;href&quot;</span><span class="punctuation">:</span> <span class="string">&quot;http://localhost:8080/api/profile/tacos&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;recents&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;href&quot;</span><span class="punctuation">:</span> <span class="string">&quot;http://localhost:8080/api/tacos/recent&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"> ...</span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<h4 id="添加自定义的端点"><a href="#添加自定义的端点" class="headerlink" title="添加自定义的端点"></a>添加自定义的端点</h4><p>当我们需要除了CRUE API以外的操作时，需要自定义端点.</p>
<p>如果用@RestController类解决，会有以下问题：</p>
<ul>
<li>我们自己的控制器端点没有映射到Spring Data REST的基础路径下</li>
<li>在自己控制器所定义的端点中，返回资源时并不会自动包含超链接，与Spring Data REST返回的资源是不同的.</li>
<li>并且客户端很难从链接列表(主资源)中查找URL</li>
</ul>
<h5 id="新功能"><a href="#新功能" class="headerlink" title="新功能"></a>新功能</h5><ul>
<li>可以直接从主资源路径下直接找到端点</li>
<li>客户端可以更好找到所有API</li>
</ul>
<h5 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h5><ul>
<li>新建控制类</li>
<li>添加<strong>类级别@RepositoryRestController</strong><ul>
<li>为类中<strong>所有方法</strong>的<strong>映射</strong>都添加(spring-data-rest- base-path：&#x2F;路径 )的<strong>前缀</strong></li>
<li><strong>不能和@RestController共用</strong></li>
</ul>
</li>
<li>在方法中<strong>自定义路径</strong>以及<strong>指定返回类型</strong>（很重要）<ul>
<li><strong>path</strong>：映射路径</li>
<li><strong>produces</strong>：**”application&#x2F;hal+json”**</li>
</ul>
</li>
<li>写入响应体<ul>
<li>给<strong>方法添加@ResponseBody</strong></li>
<li><strong>返回包装响应数据的ResponseEntity对象</strong></li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RepositoryRestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RecentTacosController</span> &#123;</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(path=&quot;/tacos/abc/recent&quot;, produces=&quot;application/hal+json&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;CollectionModel&lt;TacoEntityModel&gt;&gt; <span class="title function_">recentTacos</span><span class="params">()</span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="type">PageRequest</span> <span class="variable">page</span> <span class="operator">=</span> PageRequest.of(<span class="number">0</span>, <span class="number">12</span>, Sort.by(<span class="string">&quot;createdat&quot;</span>).descending());</span><br><span class="line">        </span><br><span class="line">        List&lt;Taco&gt; tacos = tacoRepo.findAll(page).getContent();</span><br><span class="line"></span><br><span class="line">        CollectionModel&lt;TacoEntityModel&gt; tacoResources =</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">TacoEntityModelAssembler</span>().toCollectionModel(tacos);</span><br><span class="line"></span><br><span class="line">      tacoEntityModels.add(</span><br><span class="line">  WebMvcLinkBuilder</span><br><span class="line">          .linkTo(WebMvcLinkBuilder.methodOn(DesignTacoController.class).recentTaco())</span><br><span class="line">          .withRel(<span class="string">&quot;abc123&quot;</span>)</span><br><span class="line">        );</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseEntity</span>&lt;&gt;(tacoResources, HttpStatus.OK);</span><br><span class="line">    &#125;</span><br><span class="line">...</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//访问路径 /api/tacos/abc/recent</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h5 id="为Spring-Data-端点添加自定义的超链接"><a href="#为Spring-Data-端点添加自定义的超链接" class="headerlink" title="为Spring Data 端点添加自定义的超链接"></a>为Spring Data 端点添加自定义的超链接</h5><p>通过声明资源处理器bean&#x3D;&#x3D;》为Spring Data REST自动包含的链接<strong>添加继续添加链接</strong></p>
<h6 id="解决方法-1"><a href="#解决方法-1" class="headerlink" title="解决方法"></a>解决方法</h6><p>在上面的类继续添加</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> RepresentationModelProcessor&lt;PagedModel&lt;EntityModel&lt;实体类&gt;&gt;&gt; tacoProcessor(EntityLinks links) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RepresentationModelProcessor</span>&lt;PagedModel&lt;EntityModel&lt;实体类&gt;&gt;&gt;() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> PagedModel&lt;EntityModel&lt;实体类&gt;&gt; process(PagedModel&lt;EntityModel&lt;实体类&gt;&gt; resource) &#123;</span><br><span class="line">            resource.add(</span><br><span class="line">                    links.linkFor(实体类.class)</span><br><span class="line">                            .slash(<span class="string">&quot;abc&quot;</span>)</span><br><span class="line">                            .slash(<span class="string">&quot;recent&quot;</span>)</span><br><span class="line">                            .withRel(<span class="string">&quot;recents&quot;</span>));</span><br><span class="line">            <span class="comment">//添加的超链接路径=基础路径+实体类的路径+/abc+/recent        </span></span><br><span class="line">            <span class="keyword">return</span> resource;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h6><p>不要转Lamba，会有bug</p>
</div><div class="article-licensing box"><div class="licensing-title"><p>Spring实战(第5版)</p><p><a href="https://liust1918.github.io/Liust1918.githud.io/2022/12/03/Spring实战-第5版/">https://liust1918.github.io/Liust1918.githud.io/2022/12/03/Spring实战-第5版/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>作者</h6><p>Liust</p></div></div><div class="level-item is-narrow"><div><h6>发布于</h6><p>2022-12-03</p></div></div><div class="level-item is-narrow"><div><h6>更新于</h6><p>2022-12-04</p></div></div><div class="level-item is-narrow"><div><h6>许可协议</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/Liust1918.githud.io/tags/java/">java</a><a class="link-muted mr-2" rel="tag" href="/Liust1918.githud.io/tags/%E5%90%8E%E7%AB%AF/">后端</a><a class="link-muted mr-2" rel="tag" href="/Liust1918.githud.io/tags/%E6%8A%80%E6%9C%AF%E4%B9%A6/">技术书</a><a class="link-muted mr-2" rel="tag" href="/Liust1918.githud.io/tags/spring/">spring</a><a class="link-muted mr-2" rel="tag" href="/Liust1918.githud.io/tags/Hibernate/">Hibernate</a></div><!--!--></article></div><div class="card"><div class="card-content"><h3 class="menu-label has-text-centered">喜欢这篇文章？打赏一下作者吧</h3><div class="buttons is-centered"><a class="button donate" href="/Liust1918.githud.io/" target="_blank" rel="noopener" data-type="buymeacoffee"><span class="icon is-small"><i class="fas fa-coffee"></i></span><span>送我杯咖啡</span></a></div></div></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/Liust1918.githud.io/2022/12/04/Android%E5%85%A5%E9%97%A8/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">Android入门</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/Liust1918.githud.io/2022/12/03/%E9%87%8D%E5%AD%A6SpirngBoot2-X/"><span class="level-item">重学SpirngBoot2.X</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><!--!--></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1 is-sticky"><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">目录</h3><ul class="menu-list"><li><a class="level is-mobile" href="#Spring实战-第5版-书-弃用"><span class="level-left"><span class="level-item">1</span><span class="level-item">Spring实战(第5版)书(弃用)</span></span></a></li><li><a class="level is-mobile" href="#Spring基础"><span class="level-left"><span class="level-item">2</span><span class="level-item">Spring基础</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#Spring起步"><span class="level-left"><span class="level-item">2.1</span><span class="level-item">Spring起步</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#什么是Spring"><span class="level-left"><span class="level-item">2.1.1</span><span class="level-item">什么是Spring</span></span></a></li><li><a class="level is-mobile" href="#Spring项目结构"><span class="level-left"><span class="level-item">2.1.2</span><span class="level-item">Spring项目结构</span></span></a></li><li><a class="level is-mobile" href="#SpringBoot项目启动方式"><span class="level-left"><span class="level-item">2.1.3</span><span class="level-item">SpringBoot项目启动方式</span></span></a></li><li><a class="level is-mobile" href="#Spring-Boot-DevTools"><span class="level-left"><span class="level-item">2.1.4</span><span class="level-item">Spring Boot DevTools</span></span></a></li></ul></li><li><a class="level is-mobile" href="#开发Web应用"><span class="level-left"><span class="level-item">2.2</span><span class="level-item">开发Web应用</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#设计后端"><span class="level-left"><span class="level-item">2.2.1</span><span class="level-item">设计后端</span></span></a></li><li><a class="level is-mobile" href="#处理表单提交"><span class="level-left"><span class="level-item">2.2.2</span><span class="level-item">处理表单提交</span></span></a></li><li><a class="level is-mobile" href="#校验表单输入-JSR-303"><span class="level-left"><span class="level-item">2.2.3</span><span class="level-item">校验表单输入(JSR-303)</span></span></a></li><li><a class="level is-mobile" href="#使用视图控制器"><span class="level-left"><span class="level-item">2.2.4</span><span class="level-item">使用视图控制器</span></span></a></li><li><a class="level is-mobile" href="#选择视图模板库"><span class="level-left"><span class="level-item">2.2.5</span><span class="level-item">选择视图模板库</span></span></a></li></ul></li><li><a class="level is-mobile" href="#数据持久化"><span class="level-left"><span class="level-item">2.3</span><span class="level-item">数据持久化</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#Spring消除JDBC样板代码"><span class="level-left"><span class="level-item">2.3.1</span><span class="level-item">Spring消除JDBC样板代码</span></span></a></li><li><a class="level is-mobile" href="#JPA重写数据Repository"><span class="level-left"><span class="level-item">2.3.2</span><span class="level-item">JPA重写数据Repository</span></span></a></li><li><a class="level is-mobile" href="#ModelAttribute运用"><span class="level-left"><span class="level-item">2.3.3</span><span class="level-item">@ModelAttribute运用</span></span></a></li></ul></li><li><a class="level is-mobile" href="#保护Spring"><span class="level-left"><span class="level-item">2.4</span><span class="level-item">保护Spring</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#引入Spring-Security"><span class="level-left"><span class="level-item">2.4.1</span><span class="level-item">引入Spring Security</span></span></a></li><li><a class="level is-mobile" href="#配置Spring-Security"><span class="level-left"><span class="level-item">2.4.2</span><span class="level-item">配置Spring Security</span></span></a></li><li><a class="level is-mobile" href="#用户存储"><span class="level-left"><span class="level-item">2.4.3</span><span class="level-item">用户存储</span></span></a></li><li><a class="level is-mobile" href="#保护Web请求"><span class="level-left"><span class="level-item">2.4.4</span><span class="level-item">保护Web请求</span></span></a></li><li><a class="level is-mobile" href="#防止跨站请求伪造CSRF"><span class="level-left"><span class="level-item">2.4.5</span><span class="level-item">防止跨站请求伪造CSRF</span></span></a></li><li><a class="level is-mobile" href="#获取用户信息"><span class="level-left"><span class="level-item">2.4.6</span><span class="level-item">获取用户信息</span></span></a></li></ul></li><li><a class="level is-mobile" href="#使用配置属性"><span class="level-left"><span class="level-item">2.5</span><span class="level-item">使用配置属性</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#细粒度的自动配置"><span class="level-left"><span class="level-item">2.5.1</span><span class="level-item">细粒度的自动配置</span></span></a></li><li><a class="level is-mobile" href="#通过不同属性源配置Spring"><span class="level-left"><span class="level-item">2.5.2</span><span class="level-item">通过不同属性源配置Spring</span></span></a></li><li><a class="level is-mobile" href="#配置数据源"><span class="level-left"><span class="level-item">2.5.3</span><span class="level-item">配置数据源</span></span></a></li><li><a class="level is-mobile" href="#配置嵌入式服务器"><span class="level-left"><span class="level-item">2.5.4</span><span class="level-item">配置嵌入式服务器</span></span></a></li><li><a class="level is-mobile" href="#配置日志"><span class="level-left"><span class="level-item">2.5.5</span><span class="level-item">配置日志</span></span></a></li><li><a class="level is-mobile" href="#使用其他配置属性的属性值"><span class="level-left"><span class="level-item">2.5.6</span><span class="level-item">使用其他配置属性的属性值</span></span></a></li><li><a class="level is-mobile" href="#创建自己的配置属性"><span class="level-left"><span class="level-item">2.5.7</span><span class="level-item">创建自己的配置属性</span></span></a></li><li><a class="level is-mobile" href="#定义配置属性的持有者"><span class="level-left"><span class="level-item">2.5.8</span><span class="level-item">定义配置属性的持有者</span></span></a></li><li><a class="level is-mobile" href="#声明配置属性元数据"><span class="level-left"><span class="level-item">2.5.9</span><span class="level-item">声明配置属性元数据</span></span></a></li><li><a class="level is-mobile" href="#使用profile条件化创建bean"><span class="level-left"><span class="level-item">2.5.10</span><span class="level-item">使用profile条件化创建bean</span></span></a></li></ul></li></ul></li><li><a class="level is-mobile" href="#Spring集成"><span class="level-left"><span class="level-item">3</span><span class="level-item">Spring集成</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#创建Rest服务"><span class="level-left"><span class="level-item">3.1</span><span class="level-item">创建Rest服务</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#两种程序设计模式"><span class="level-left"><span class="level-item">3.1.1</span><span class="level-item">两种程序设计模式</span></span></a></li><li><a class="level is-mobile" href="#创建RESTful控制器类"><span class="level-left"><span class="level-item">3.1.2</span><span class="level-item">创建RESTful控制器类</span></span></a></li><li><a class="level is-mobile" href="#RESTful控制器类中的HTTP请求处理"><span class="level-left"><span class="level-item">3.1.3</span><span class="level-item">RESTful控制器类中的HTTP请求处理</span></span></a></li><li><a class="level is-mobile" href="#RESTful控制器类中的HTTP参数处理"><span class="level-left"><span class="level-item">3.1.4</span><span class="level-item">RESTful控制器类中的HTTP参数处理</span></span></a></li><li><a class="level is-mobile" href="#启用超媒体"><span class="level-left"><span class="level-item">3.1.5</span><span class="level-item">启用超媒体</span></span></a></li><li><a class="level is-mobile" href="#添加超链接"><span class="level-left"><span class="level-item">3.1.6</span><span class="level-item">添加超链接</span></span></a></li><li><a class="level is-mobile" href="#创建资源装配器"><span class="level-left"><span class="level-item">3.1.7</span><span class="level-item">创建资源装配器</span></span></a></li><li><a class="level is-mobile" href="#命名嵌套式的关联关系"><span class="level-left"><span class="level-item">3.1.8</span><span class="level-item">命名嵌套式的关联关系</span></span></a></li><li><a class="level is-mobile" href="#启用数据后端服务"><span class="level-left"><span class="level-item">3.1.9</span><span class="level-item">启用数据后端服务</span></span></a></li><li><a class="level is-mobile" href="#添加自定义的端点"><span class="level-left"><span class="level-item">3.1.10</span><span class="level-item">添加自定义的端点</span></span></a></li></ul></li></ul></li></ul></div></div><style>#toc .menu-list > li > a.is-active + .menu-list { display: block; }#toc .menu-list > li > a + .menu-list { display: none; }</style><script src="/Liust1918.githud.io/js/toc.js" defer></script></div><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">分类</h3><ul class="menu-list"><li><a class="level is-mobile" href="/Liust1918.githud.io/categories/Android/"><span class="level-start"><span class="level-item">Android</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/Liust1918.githud.io/categories/C%E8%AF%AD%E8%A8%80/"><span class="level-start"><span class="level-item">C语言</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/Liust1918.githud.io/categories/Hexo/"><span class="level-start"><span class="level-item">Hexo</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/Liust1918.githud.io/categories/LeetCode/"><span class="level-start"><span class="level-item">LeetCode</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile" href="/Liust1918.githud.io/categories/git/"><span class="level-start"><span class="level-item">git</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/Liust1918.githud.io/categories/java/"><span class="level-start"><span class="level-item">java</span></span><span class="level-end"><span class="level-item tag">3</span></span></a><ul><li><a class="level is-mobile" href="/Liust1918.githud.io/categories/java/java8/"><span class="level-start"><span class="level-item">java8</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/Liust1918.githud.io/categories/java/%E5%8F%8D%E5%B0%84/"><span class="level-start"><span class="level-item">反射</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/Liust1918.githud.io/categories/java/%E6%B3%A8%E8%A7%A3/"><span class="level-start"><span class="level-item">注解</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/Liust1918.githud.io/categories/%E5%90%8E%E7%AB%AF/"><span class="level-start"><span class="level-item">后端</span></span><span class="level-end"><span class="level-item tag">5</span></span></a><ul><li><a class="level is-mobile" href="/Liust1918.githud.io/categories/%E5%90%8E%E7%AB%AF/SSM/"><span class="level-start"><span class="level-item">SSM</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/Liust1918.githud.io/categories/%E5%90%8E%E7%AB%AF/spring/"><span class="level-start"><span class="level-item">spring</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/Liust1918.githud.io/categories/%E5%90%8E%E7%AB%AF/%E6%95%B0%E6%8D%AE%E5%BA%93/"><span class="level-start"><span class="level-item">数据库</span></span><span class="level-end"><span class="level-item tag">1</span></span></a><ul><li><a class="level is-mobile" href="/Liust1918.githud.io/categories/%E5%90%8E%E7%AB%AF/%E6%95%B0%E6%8D%AE%E5%BA%93/Mysql/"><span class="level-start"><span class="level-item">Mysql</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li></ul></li><li><a class="level is-mobile" href="/Liust1918.githud.io/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"><span class="level-start"><span class="level-item">设计模式</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">标签</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/Liust1918.githud.io/tags/Android/"><span class="tag">Android</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/Liust1918.githud.io/tags/C/"><span class="tag">C</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/Liust1918.githud.io/tags/C/"><span class="tag">C++</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/Liust1918.githud.io/tags/Hexo/"><span class="tag">Hexo</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/Liust1918.githud.io/tags/Hibernate/"><span class="tag">Hibernate</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/Liust1918.githud.io/tags/LeetCode/"><span class="tag">LeetCode</span><span class="tag">9</span></a></div><div class="control"><a class="tags has-addons" href="/Liust1918.githud.io/tags/SSM/"><span class="tag">SSM</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/Liust1918.githud.io/tags/git/"><span class="tag">git</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/Liust1918.githud.io/tags/githud/"><span class="tag">githud</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/Liust1918.githud.io/tags/java/"><span class="tag">java</span><span class="tag">19</span></a></div><div class="control"><a class="tags has-addons" href="/Liust1918.githud.io/tags/java8/"><span class="tag">java8</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/Liust1918.githud.io/tags/mysql/"><span class="tag">mysql</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/Liust1918.githud.io/tags/spring/"><span class="tag">spring</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/Liust1918.githud.io/tags/springboot2/"><span class="tag">springboot2</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/Liust1918.githud.io/tags/%E5%8F%8D%E5%B0%84/"><span class="tag">反射</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/Liust1918.githud.io/tags/%E5%90%8E%E7%AB%AF/"><span class="tag">后端</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/Liust1918.githud.io/tags/%E6%8A%80%E6%9C%AF%E4%B9%A6/"><span class="tag">技术书</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/Liust1918.githud.io/tags/%E6%B3%A8%E8%A7%A3/"><span class="tag">注解</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/Liust1918.githud.io/tags/%E7%AE%97%E6%B3%95/"><span class="tag">算法</span><span class="tag">9</span></a></div><div class="control"><a class="tags has-addons" href="/Liust1918.githud.io/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"><span class="tag">设计模式</span><span class="tag">1</span></a></div></div></div></div></div><div class="card widget" data-type="adsense"><div class="card-content"><div class="menu"><h3 class="menu-label">广告</h3><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><ins class="adsbygoogle" style="display:block" data-ad-client="liust" data-ad-slot="1918" data-ad-format="auto" data-full-width-responsive="true"></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});</script></div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">follow.it</h3><form action="" method="post" target="_blank"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="订阅"></div></div></form></div></div></div><div class="column-right-shadow is-hidden-widescreen"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="/Liust1918.githud.io/img/Battlerfiled3.jpg" alt="Liust1918"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">Liust1918</p><p class="is-size-6 is-block">Web Developer</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Ice Earth</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/Liust1918.githud.io/archives"><p class="title">22</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/Liust1918.githud.io/categories"><p class="title">15</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/Liust1918.githud.io/tags"><p class="title">20</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/Liust1918" target="_blank" rel="noopener">关注我</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/Liust1918"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/Liust1918.githud.io/"><i class="fas fa-rss"></i></a></div></div></div><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">链接</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://github.com/Liust1918" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Githud</span></span><span class="level-right"><span class="level-item tag">github.com</span></span></a></li></ul></div></div></div><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-02-22T15:46:48.000Z">2023-02-22</time></p><p class="title"><a href="/Liust1918.githud.io/2023/02/22/java%E6%B3%A8%E8%A7%A3/">java注解</a></p><p class="categories"><a href="/Liust1918.githud.io/categories/java/">java</a> / <a href="/Liust1918.githud.io/categories/java/%E6%B3%A8%E8%A7%A3/">注解</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-02-22T06:04:30.000Z">2023-02-22</time></p><p class="title"><a href="/Liust1918.githud.io/2023/02/22/java%E5%8F%8D%E5%B0%84/">java反射</a></p><p class="categories"><a href="/Liust1918.githud.io/categories/java/">java</a> / <a href="/Liust1918.githud.io/categories/java/%E5%8F%8D%E5%B0%84/">反射</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-12-03T17:11:33.000Z">2022-12-04</time></p><p class="title"><a href="/Liust1918.githud.io/2022/12/04/Mysql%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A/">Mysql必知必会书</a></p><p class="categories"><a href="/Liust1918.githud.io/categories/%E5%90%8E%E7%AB%AF/">后端</a> / <a href="/Liust1918.githud.io/categories/%E5%90%8E%E7%AB%AF/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a> / <a href="/Liust1918.githud.io/categories/%E5%90%8E%E7%AB%AF/%E6%95%B0%E6%8D%AE%E5%BA%93/Mysql/">Mysql</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-12-03T16:56:56.000Z">2022-12-04</time></p><p class="title"><a href="/Liust1918.githud.io/2022/12/04/SSM/">SSM</a></p><p class="categories"><a href="/Liust1918.githud.io/categories/%E5%90%8E%E7%AB%AF/">后端</a> / <a href="/Liust1918.githud.io/categories/%E5%90%8E%E7%AB%AF/SSM/">SSM</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-12-03T16:56:56.000Z">2022-12-04</time></p><p class="title"><a href="/Liust1918.githud.io/2022/12/04/SSM%E9%87%8D%E6%96%B0%E5%AD%A6%E4%B9%A0/">SSM重新学习</a></p><p class="categories"><a href="/Liust1918.githud.io/categories/%E5%90%8E%E7%AB%AF/">后端</a> / <a href="/Liust1918.githud.io/categories/%E5%90%8E%E7%AB%AF/SSM/">SSM</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">归档</h3><ul class="menu-list"><li><a class="level is-mobile" href="/Liust1918.githud.io/archives/2023/02/"><span class="level-start"><span class="level-item">二月 2023</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/Liust1918.githud.io/archives/2022/12/"><span class="level-start"><span class="level-item">十二月 2022</span></span><span class="level-end"><span class="level-item tag">20</span></span></a></li></ul></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/Liust1918.githud.io/"><img src="/Liust1918.githud.io/img/Battlerfiled3.jpg" alt="Liust of Blog" height="28"></a><p class="is-size-7"><span>&copy; 2023 Liust</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="My GitHub" href="https://github.com/Liust1918"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/Liust1918.githud.io/js/column.js"></script><script src="/Liust1918.githud.io/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/Liust1918.githud.io/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "此网站使用Cookie来改善您的体验。",
          dismiss: "知道了！",
          allow: "允许使用Cookie",
          deny: "拒绝",
          link: "了解更多",
          policy: "Cookie政策",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/Liust1918.githud.io/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/Liust1918.githud.io/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/Liust1918.githud.io/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>